/*sketchpad.pro - free online drawing*/!function(t){"use strict";function e(){this.registeredCallbacks={},this.registeredCallbacksOnce={}}function i(t){function i(t){var e=d.normalize(t.offsetY,0,d.hueCanvas.height),i=e/d.hueCanvas.height*360;d.changeHue(i)}function s(t){var e=d.normalize(t.offsetX,0,d.paletteCanvas.width),i=d.normalize(t.offsetY,0,d.paletteCanvas.height),s=e/d.paletteCanvas.width*100,o=i/d.paletteCanvas.height*100;d.pickPalette(s,o)}function r(t){var e=d.normalize(t.offsetX,0,d.alphaCanvas.width),i=e/d.alphaCanvas.width*1;d.changeAlpha(i)}function a(t){d.changeAlpha(d.color.alpha-t.deltaX/100/2),t.preventDefault()}function n(t){d.changeHue(d.color.hue-t.deltaY/2),t.preventDefault()}function h(t){d.pickPalette(d.color.saturation-t.deltaX/2,d.color.value-t.deltaY/2),t.preventDefault()}e.call(this,t),"object"!=typeof t.keyModifiers&&(t.keyModifiers={});var c=t.containerEl;this.containerEl=c,c.classList.add("colorpalette");this.width=200,this.height=220,this.color={hue:0,saturation:0,value:0,red:0,green:0,blue:0,alpha:1},c.style.position="relative",c.style.width="200px",c.style.height="220px",c.style.display="inline-block",this.colorBgEl=document.createElement("div"),this.colorBgEl.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4AcGEAAdMvv9RwAAAFBJREFUWMPt18EJACAIhWGLNnJah3Im28B36CDE/66CfBCirYgoa5KZ9hJ3b+vbhgMAAICj5lzNsYrqzxMAAAAAAAAA8/eA2vf8CwAA+B5wAUhhDw4II7MzAAAAAElFTkSuQmCC')",this.colorBgEl.style.backgroundSize="16px",this.colorBgEl.style.backgroundPosition="50% 50%",this.colorBgEl.className="color-bg",this.colorBgEl.style.width="200px",this.colorBgEl.style.height=Math.floor(20)+"px",this.colorBgEl.style.borderRadius=window.radius+"px "+window.radius+"px 0px 0px",this.colorBgEl.style.overflow="hidden",this.colorEl=document.createElement("div"),this.colorEl.className="color",this.colorEl.style.width="100%",this.colorEl.style.height="100%",this.colorEl.style.cursor="pointer",this.colorBgEl.appendChild(this.colorEl),this.colorBgEl.style.position="absolute",this.colorBgEl.style.top="0px",this.colorBgEl.style.left="0px",this.paletteCanvas=document.createElement("canvas"),this.paletteCanvas.className="palette",this.paletteCanvas.width=180,this.paletteCanvas.height=Math.floor(180),this.paletteContext2d=this.paletteCanvas.getContext("2d"),this.paletteIData=this.paletteContext2d.createImageData(this.paletteCanvas.width,this.paletteCanvas.height),this.paletteCanvas.style.cursor="crosshair",this.paletteCanvas.style.position="absolute",this.paletteCanvas.style.left="0px",this.paletteCanvas.style.top=Math.floor(20)+"px",this.palettePointerEl=document.createElement("div"),this.palettePointerEl.className="pointer palette-pointer",this.palettePointerEl.position="absolute",this.palettePointerEl.style.width="12px",this.palettePointerEl.style.height="12px",this.palettePointerEl.style.backgroundColor="white",this.palettePointerEl.style.position="absolute",this.palettePointerEl.style.borderRadius="50%",this.palettePointerEl.style.cursor="crosshair",this.palettePointerEl.style.boxShadow="inset 0 0 2px #000",this.hueCanvas=document.createElement("canvas"),this.hueCanvas.className="hue",this.hueCanvas.width=20,this.hueCanvas.height=180,this.hueContext2d=this.hueCanvas.getContext("2d"),this.hueIData=this.hueContext2d.createImageData(this.hueCanvas.width,this.hueCanvas.height),this.hueCanvas.style.cursor="row-resize",this.hueCanvas.style.position="absolute",this.hueCanvas.style.top="20px",this.hueCanvas.style.left="180px",this.hueSliderEl=document.createElement("div"),this.hueSliderEl.className="slider hue-slider",this.hueSliderEl.style.width="24px",this.hueSliderEl.style.height="6.6px",this.hueSliderEl.style.position="absolute",this.hueSliderEl.style.top="22px",this.hueSliderEl.style.left="178px",this.hueSliderEl.style.backgroundColor="white",this.hueSliderEl.style.cursor="row-resize",this.hueSliderEl.style.boxShadow="inset 0 0 2px #000",this.hueSliderEl.style.zIndex=100,this.alphaCanvas=document.createElement("canvas"),this.alphaCanvas.className="alpha",this.alphaCanvas.width=200,this.alphaCanvas.height=20,this.alphaContext2d=this.alphaCanvas.getContext("2d"),this.alphaIData=this.alphaContext2d.createImageData(this.alphaCanvas.width,this.alphaCanvas.height),this.alphaCanvas.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4AcGEAAdMvv9RwAAAFBJREFUWMPt18EJACAIhWGLNnJah3Im28B36CDE/66CfBCirYgoa5KZ9hJ3b+vbhgMAAICj5lzNsYrqzxMAAAAAAAAA8/eA2vf8CwAA+B5wAUhhDw4II7MzAAAAAElFTkSuQmCC')",this.alphaCanvas.style.backgroundSize="16px",this.alphaCanvas.style.backgroundPosition="50% 50%",this.alphaCanvas.style.cursor="col-resize",this.alphaCanvas.style.position="absolute",this.alphaCanvas.style.top="200px",this.alphaCanvas.style.left="0px",this.alphaCanvas.style.borderRadius="0px 0px "+window.radius+"px "+window.radius+"px",this.alphaCanvas.style.overflow="hidden",this.alphaSliderEl=document.createElement("div"),this.alphaSliderEl.className="slider alpha-slider",this.alphaSliderEl.style.width="6px",this.alphaSliderEl.style.height="24.2px",this.alphaSliderEl.style.backgroundColor="white",this.alphaSliderEl.style.position="absolute",this.alphaSliderEl.style.top="197.8px",this.alphaSliderEl.style.left=this.alphaCanvas.width-3+"px",this.alphaSliderEl.style.cursor="col-resize",this.alphaSliderEl.style.boxShadow="inset 0 0 2px #000",this.alphaSliderEl.style.zIndex=100,this.redInput=document.createElement("input"),this.redInput.title="R:",this.greenInput=document.createElement("input"),this.greenInput.title="G:",this.blueInput=document.createElement("input"),this.blueInput.title="B:",this.alphaInput=document.createElement("input"),this.alphaInput.title="A:",this.valuesEl=document.createElement("div");var d=this;return[this.redInput,this.greenInput,this.blueInput,this.alphaInput].forEach(function(t){var e=document.createElement("span");e.textContent=t.title,d.valuesEl.appendChild(e),d.valuesEl.appendChild(t),t.type="number",t.className=t.title,t===d.alphaInput?(t.min=0,t.max=1,t.step=.01,t.maxLength=4):(t.min=0,t.max=255,t.step=1,t.maxLength=3),t.addEventListener("change",function(){d.updateFromInputs()})}),c.appendChild(this.colorBgEl),c.appendChild(this.paletteCanvas),c.appendChild(this.hueCanvas),c.appendChild(this.alphaCanvas),c.appendChild(this.hueSliderEl),c.appendChild(this.alphaSliderEl),c.appendChild(this.palettePointerEl),this.drawHue(),this.drawPalette(this.color.hue),o(this.hueCanvas,"slide",i),o(this.colorEl,"tap",function(){var t=d.getColor();d.dispatch("set",{color:t})}),o(this.paletteCanvas,"slide",s),o(this.alphaCanvas,"slide",r),this.setHueSlider(0),t.color&&this.setColor(t.color),this.alphaCanvas.addEventListener("wheel",a),this.alphaSliderEl.addEventListener("wheel",a),this.hueCanvas.addEventListener("wheel",n),this.hueSliderEl.addEventListener("wheel",n),this.paletteCanvas.addEventListener("wheel",h),this.palettePointerEl.addEventListener("wheel",h),this.keyshortcuts=new l,this.keyshortcuts.disable(),this.keyshortcuts.addShortcut(Object.assign({altKey:!1,keyCode:38,repeatable:!0},t.keyModifiers),function(){d.changeHue(d.color.hue-1)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!1,keyCode:40,repeatable:!0},t.keyModifiers),function(){d.changeHue(d.color.hue+1)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!1,keyCode:37,repeatable:!0},t.keyModifiers),function(){d.changeAlpha(d.color.alpha-.01)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!1,keyCode:39,repeatable:!0},t.keyModifiers),function(){d.changeAlpha(d.color.alpha+.01)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!0,keyCode:38,repeatable:!0},t.keyModifiers),function(){d.pickPalette(d.color.saturation,d.color.value-1)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!0,keyCode:40,repeatable:!0},t.keyModifiers),function(){d.pickPalette(d.color.saturation,d.color.value+1)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!0,keyCode:37,repeatable:!0},t.keyModifiers),function(){d.pickPalette(d.color.saturation-1,d.color.value)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!0,keyCode:39,repeatable:!0},t.keyModifiers),function(){d.pickPalette(d.color.saturation+1,d.color.value)}),this}function s(t){var e=t.getBoundingClientRect();return{x:0-e.left,y:0-e.top}}function o(t,e,i,o){function r(){var t="";return window.getSelection?t=window.getSelection().toString():void 0!==document.selection&&"Text"===document.selection.type&&(t=document.selection.createRange().text),t}function a(e){var o,r,a=s(t);for(o=0;o<e.changedTouches.length;o+=1)r=e.changedTouches[o],r.offsetX=r.clientX+a.x,r.offsetY=r.clientY+a.y,i(r)}var n,l;switch(e){case"swipe-right":console.log("adding swipe right"),t.addEventListener("touchstart",function(t){n=t.changedTouches[0]},o),t.addEventListener("mousedown",function(t){console.log("mdsr"),n=t},o),t.addEventListener("touchend",function(t){(l=t.changedTouches[t.changedTouches.length-1])&&n&&l.screenX-n.screenX>30&&!r()&&"text"!==document.activeElement.type&&i(t)},o),t.addEventListener("mouseup",function(t){(l=t)&&n&&l.screenX-n.screenX>30&&!r()&&"text"!==document.activeElement.type&&i(t)},o);break;case"hover-in":t.addEventListener("touchstart",function(t){var e;for(e=0;e<t.changedTouches.length;e+=1)i(t.changedTouches[e])},o),t.addEventListener("touchmove",function(t){var e;for(e=0;e<t.changedTouches.length;e+=1)i(t.changedTouches[e])},o),t.addEventListener("mouseover",i,o);break;case"hover-out":t.addEventListener("mouseout",i,o);break;case"tap":t.addEventListener("touchstart",function(t){t.preventDefault(),document.activeElement!==t.target&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur();var e;for(e=0;e<t.changedTouches.length;e+=1)t.changedTouches[e].stopPropagation=t.stopPropagation&&t.stopPropagation.bind(t),t.changedTouches[e].preventDefault=t.preventDefault&&t.preventDefault.bind(t),i(t.changedTouches[e]);t.preventMouseFallback=!0},o),t.addEventListener("mousedown",function(t){i(t)},o);break;case"pop":t.addEventListener("touchend",function(t){t.preventDefault(),document.activeElement!==t.target&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur();var e;for(e=0;e<t.changedTouches.length;e+=1)t.changedTouches[e].stopPropagation=t.stopPropagation&&t.stopPropagation.bind(t),t.changedTouches[e].preventDefault=t.preventDefault&&t.preventDefault.bind(t),i(t.changedTouches[e]);t.preventMouseFallback=!0},o),t.addEventListener("mouseup",function(t){i(t)},o);break;case"slide":t.addEventListener("mousedown",i,o),t.addEventListener("mouseup",i,o),t.addEventListener("mousemove",function(t){(t.buttons||void 0===t.buttons&&t.which)&&i(t)},o),t.addEventListener("touchstart",a,o),t.addEventListener("touchend",a,o),t.addEventListener("touchmove",a,o);break;default:t.addEventListener(e,i,o)}}function r(t){function i(t){h.setFont(t.target.value)}function s(t){var e=h.normalize(h.width+t.offsetX,0,h.width),i=h.minSize+e/h.width*(h.maxSize-h.minSize);h.setSize(i)}function r(t){t.preventDefault(),h.setSize(h.size-t.deltaY/2)}function a(t){t.preventDefault(),h.setSize(h.size-t.deltaX/2)}e.call(this,t),"object"!=typeof t.keyModifiers&&(t.keyModifiers={});var n=t.containerEl;this.containerEl=n,n.classList.add("fontpalette");this.width=200,this.height=220,this.font="Georgia",this.size=60,this.color={hue:0,saturation:0,value:0,red:0,green:0,blue:0,alpha:1},this.minSize=t.minSize||10,this.maxSize=t.maxSize||100,this.fontList=t.fontList||["Arial","Arial Black","Arial Narrow","Courier New","Lucida Sans Typewriter","Papyrus","Tahoma","Times New Roman","Trebuchet MS","Comic Sans MS","Verdana"],n.style.position="relative",n.style.width="200px",n.style.height="220px",n.style.display="inline-block";var h=this;this.fontListSelectEl=document.createElement("select"),this.fontListSelectEl.style.height=Math.floor(20)+"px",this.fontListSelectEl.style.width="100%",this.fontListSelectEl.style.lineHeight=Math.floor(20)+"px",this.fontList.forEach(function(t){var e=document.createElement("option");e.value=t,e.textContent=t,h.fontListSelectEl.appendChild(e)}),this.fontListSelectEl.addEventListener("change",i),this.previewCanvas=document.createElement("canvas"),this.previewCanvas.className="palette",this.previewCanvas.width=200,this.previewCanvas.height=Math.floor(180),this.previewContext2d=this.previewCanvas.getContext("2d"),this.paletteIData=this.previewContext2d.createImageData(this.previewCanvas.width,this.previewCanvas.height),this.previewCanvas.style.cursor="crosshair",this.previewCanvas.style.position="absolute",this.previewCanvas.style.left="0px",this.previewCanvas.style.top="20px",this.sizeEl=document.createElement("div"),this.sizeEl.style.backgroundColor="transparent",this.sizeEl.style.position="absolute",this.sizeEl.className="bg",this.sizeEl.style.top="200px",this.sizeEl.style.left="0px",this.sizeEl.style.cursor="col-resize",this.sizeEl.style.borderLeft="200px solid transparent",this.sizeEl.style.borderBottom="20px solid black",this.sizeSliderEl=document.createElement("div"),this.sizeSliderEl.className="slider hue-slider",this.sizeSliderEl.style.marginLeft="-3px",this.sizeSliderEl.style.marginTop="-2.2px",this.sizeSliderEl.style.width="6px",this.sizeSliderEl.style.height="24.2px",this.sizeSliderEl.style.position="absolute",this.sizeSliderEl.style.top="200px",this.sizeSliderEl.style.left="0px",this.sizeSliderEl.style.backgroundColor="white",this.sizeSliderEl.style.cursor="col-resize",this.sizeSliderEl.style.boxShadow="inset 0 0 2px #000",this.sizeSliderEl.style.zIndex="100",this.previewCanvas.addEventListener("wheel",r),this.sizeSliderEl.addEventListener("wheel",a),this.sizeEl.addEventListener("wheel",a),o(this.sizeEl,"slide",s),this.keyshortcuts=new l,this.keyshortcuts.disable(),this.keyshortcuts.addShortcut(Object.assign({shiftKey:!1,keyCode:37,repeatable:!0},t.keyModifiers),function(){h.setSize(h.size-1)}),this.keyshortcuts.addShortcut(Object.assign({shiftKey:!1,keyCode:39,repeatable:!0},t.keyModifiers),function(){h.setSize(h.size+1)}),this.redrawPreview(),n.appendChild(this.fontListSelectEl),n.appendChild(this.previewCanvas),n.appendChild(this.sizeEl),n.appendChild(this.sizeSliderEl)}function a(t){e.call(this,t),"object"!=typeof t.keyModifiers&&(t.keyModifiers={});var i=t.containerEl;this.containerEl=i,i.classList.add("fontpalette");this.width=60,this.height=220,this.keyshortcuts=new l,i.style.position="relative",i.style.width="60px",i.style.height="220px",i.style.display="inline-block",i.style.fontSize="12px"}function n(t){if(e.call(this,t),this.File=void 0,this.config=t,this.postPdfUrl=X&&X.postPdfUrl||"https://uploader.imagehost.pro:3443/upload",this.postImageUrl=X&&X.postImageUrl||"https://uploader.imagehost.pro:3443/upload",this.postWebshotUrl=X&&X.postWebshotUrl||"https://uploader.imagehost.pro:3443/webshot?site=",this.proxyImageUrl=X&&X.proxyImageUrl||"https://imagehost.pro/proxy",this.proxyExcludedDomain=X&&X.proxyExcludedDomain||"imagehost.pro",t.file&&this.uploadFile(t.file),t.url)if(this.isDataURL(t.url)){if(t.file=this.dataURItoFile(t.url),!t.file)return console.error("Error - wrong data url",t.url),this;this.uploadFile(t.file)}else this.proxyUrl(t.url);return this.progressbar=new d({name:t.url,progressParentEl:t.progressParentEl||window.document.body,style:{position:"absolute",top:0,left:0,zIndex:200,height:"2px",width:"2px",backgroundColor:"rgba(155, 0, 0, 0.5)"}}),this}function l(t){e.call(this,t),this.shortcuts=[],this.registerEvents()}function h(){return{r:Math.floor(255*Math.random()),g:Math.floor(0*Math.random()),b:Math.floor(0*Math.random()),a:1}}function c(t){function i(t){var e=h.normalize(t.offsetX,0,h.paletteCanvas.width),i=h.normalize(t.offsetY,0,h.paletteCanvas.height);h.pickPalette(e,i)}function s(t){var e=h.normalize(t.offsetX,0,h.width),i=e/h.width*1;h.changeThreshold(i)}function r(t){h.changeThreshold(h.threshold-t.deltaX/100/2),t.preventDefault()}function a(t){h.pickPalette(h.x-t.deltaX/2,h.y-t.deltaY/2),t.preventDefault()}e.call(this,t),"object"!=typeof t.keyModifiers&&(t.keyModifiers={});var n=t.containerEl;this.containerEl=n,n.classList.add("Pixelpicker");this.width=200,this.height=220,this.threshold=.15,this.x=0,this.y=0,this.color={hue:0,saturation:0,value:0,red:0,green:0,blue:0,alpha:1},n.style.position="relative",n.style.width="200px",n.style.height="220px",n.style.display="inline-block",this.colorBgEl=document.createElement("div"),this.colorBgEl.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4AcGEAAdMvv9RwAAAFBJREFUWMPt18EJACAIhWGLNnJah3Im28B36CDE/66CfBCirYgoa5KZ9hJ3b+vbhgMAAICj5lzNsYrqzxMAAAAAAAAA8/eA2vf8CwAA+B5wAUhhDw4II7MzAAAAAElFTkSuQmCC')",this.colorBgEl.style.backgroundSize="16px",this.colorBgEl.style.backgroundPosition="50% 50%",this.colorBgEl.className="color-bg",this.colorBgEl.style.width="200px",this.colorBgEl.style.height=Math.floor(20)+"px",this.colorBgEl.style.borderRadius=window.radius+"px "+window.radius+"px 0px 0px",this.colorBgEl.style.overflow="hidden",this.colorEl=document.createElement("div"),this.colorEl.className="color",this.colorEl.style.width="100%",this.colorEl.style.height="100%",this.colorEl.style.cursor="pointer",this.colorBgEl.appendChild(this.colorEl),this.colorBgEl.style.position="absolute",this.colorBgEl.style.top="0px",this.colorBgEl.style.left="0px",this.paletteBgEl=document.createElement("div"),this.paletteBgEl.className="palette-bg",this.paletteBgEl.style.position="absolute",this.paletteBgEl.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4AcGEAAdMvv9RwAAAFBJREFUWMPt18EJACAIhWGLNnJah3Im28B36CDE/66CfBCirYgoa5KZ9hJ3b+vbhgMAAICj5lzNsYrqzxMAAAAAAAAA8/eA2vf8CwAA+B5wAUhhDw4II7MzAAAAAElFTkSuQmCC')",this.paletteBgEl.style.backgroundSize="16px",this.paletteBgEl.style.backgroundPosition="50% 50%",this.paletteBgEl.style.width="200px",this.paletteBgEl.style.height=Math.floor(200)+"px",this.paletteBgEl.style.borderRadius=window.radius+"px "+window.radius+"px 0px 0px",this.paletteBgEl.style.overflow="hidden",this.paletteBgEl.style.left="0px",this.paletteBgEl.style.top=Math.floor(20)+"px",this.paletteCanvas=document.createElement("canvas"),this.paletteCanvas.className="palette",this.paletteCanvas.width=200,this.paletteCanvas.height=Math.floor(200),this.paletteContext2d=this.paletteCanvas.getContext("2d"),this.paletteIData=this.paletteContext2d.createImageData(this.paletteCanvas.width,this.paletteCanvas.height),this.paletteCanvas.style.cursor="crosshair",this.paletteCanvas.style.position="absolute",this.paletteCanvas.style.left="0px",this.paletteCanvas.style.top=Math.floor(20)+"px";var h=this,c=document.createElement("img");return c.addEventListener("load",function(){h.paletteContext2d.drawImage(c,0,0,c.width,c.height,0,0,h.width,h.width*(c.height/c.width))}),c.src=t.imageSrc,this.palettePointerEl=document.createElement("div"),this.palettePointerEl.className="pointer palette-pointer",this.palettePointerEl.position="absolute",this.palettePointerEl.style.width="12px",this.palettePointerEl.style.height="12px",this.palettePointerEl.style.backgroundColor="transparent",this.palettePointerEl.style.position="absolute",this.palettePointerEl.style.border="1px solid white",this.palettePointerEl.style.borderRadius="50%",this.palettePointerEl.style.cursor="crosshair",this.palettePointerEl.style.boxShadow="inset 0 0 2px #000",this.thresholdSliderEl=document.createElement("div"),this.thresholdSliderEl.className="slider alpha-slider",this.thresholdSliderEl.style.width="6px",this.thresholdSliderEl.style.height="24.2px",this.thresholdSliderEl.style.backgroundColor="transparent",this.thresholdSliderEl.style.border="1px solid white",this.thresholdSliderEl.style.position="absolute",this.thresholdSliderEl.style.top="-2.2px",this.thresholdSliderEl.style.left=this.width-3+"px",this.thresholdSliderEl.style.cursor="col-resize",this.thresholdSliderEl.style.boxShadow="inset 0 0 2px #000",this.thresholdSliderEl.style.zIndex=100,this.redInput=document.createElement("input"),this.redInput.title="R:",this.greenInput=document.createElement("input"),this.greenInput.title="G:",this.blueInput=document.createElement("input"),this.blueInput.title="B:",this.alphaInput=document.createElement("input"),this.alphaInput.title="A:",this.valuesEl=document.createElement("div"),[this.redInput,this.greenInput,this.blueInput,this.alphaInput].forEach(function(t){var e=document.createElement("span");e.textContent=t.title,h.valuesEl.appendChild(e),h.valuesEl.appendChild(t),t.type="number",t.className=t.title,t===h.alphaInput?(t.min=0,t.max=1,t.step=.01,t.maxLength=4):(t.min=0,t.max=255,t.step=1,t.maxLength=3),t.addEventListener("change",function(){h.updateFromInputs()})}),n.appendChild(this.colorBgEl),n.appendChild(this.paletteBgEl),n.appendChild(this.paletteCanvas),n.appendChild(this.thresholdSliderEl),n.appendChild(this.palettePointerEl),o(this.paletteCanvas,"slide",i),o(this.colorEl,"slide",s),this.colorEl.addEventListener("wheel",r),this.thresholdSliderEl.addEventListener("wheel",r),this.setThresholdSlider(0),t.color&&this.setColor(t.color),this.paletteCanvas.addEventListener("wheel",a),this.palettePointerEl.addEventListener("wheel",a),this.keyshortcuts=new l,this.keyshortcuts.disable(),this.keyshortcuts.addShortcut(Object.assign({altKey:!1,keyCode:37,repeatable:!0},t.keyModifiers),function(){h.changeThreshold(h.threshold-.01)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!1,keyCode:39,repeatable:!0},t.keyModifiers),function(){h.changeThreshold(h.threshold+.01)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!0,keyCode:38,repeatable:!0},t.keyModifiers),function(){h.pickPalette(h.color.saturation,h.color.value-1)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!0,keyCode:40,repeatable:!0},t.keyModifiers),function(){h.pickPalette(h.color.saturation,h.color.value+1)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!0,keyCode:37,repeatable:!0},t.keyModifiers),function(){h.pickPalette(h.color.saturation-1,h.color.value)}),this.keyshortcuts.addShortcut(Object.assign({altKey:!0,keyCode:39,repeatable:!0},t.keyModifiers),function(){h.pickPalette(h.color.saturation+1,h.color.value)}),this}function d(t){return e.call(this,t),this.config=Object.assign({},t),this.prepareLoadingElements(),this}function p(t){return this.images=[],this.config=t,this.sketchpad=t.sketchpad,this}function u(t){return u.prototype.instance+=1,this.timestamp=(new Date).getTime(),this.type=t.type||"draw",this.uid=t.uid,this.id=t.id,this.layers=t.layers,this.tool=t.tool,this.font=t.font,this.color=t.color,this.fillColor=t.fillColor,this.size=t.size,this.center=t.center,this.listT=[],this.listX=[],this.listY=[],this.listP=[],this.lastT=NaN,this.lastX=NaN,this.lastY=NaN,this.lastP=NaN,this.lastSendPointer=0,this.lastDrawPointer=0,this.sketchpad=t.sketchpad,this.viewportX=this.sketchpad.viewportX,this.viewportY=this.sketchpad.viewportY,this.scale=this.sketchpad.scale,this.rotation=this.sketchpad.rotation,this.width=this.sketchpad.width,this.height=this.sketchpad.height,this.UID=this.sketchpad.UID,this.url=t.url,this}function g(t,e,i){var s=t.currentStyle||window.getComputedStyle(t,null),o=parseInt(s.borderLeftWidth,10)||0,r=parseInt(s.borderTopWidth,10)||0,a=t.getBoundingClientRect();return{x:e-o-a.left,y:i-r-a.top}}function f(t){var e,i=["a","e","i","o","u","y"],s=["b","c","d","g","h","j","k","l","m","n","p","r","s","t","v","w"],o="";for(e=0;e<t;e+=1)o+=s[Math.floor(Math.random()*s.length)]+i[Math.floor(Math.random()*i.length)];return o.substring(0,t)}function y(t){function i(){a.lastSendPointerX===a.pointerX&&a.lastSendPointerY===a.pointerY||(a.lastSendPointerX=a.pointerX,a.lastSendPointerY=a.pointerY,a.sendMessageToServer({cmd:"pointer-move",x:a.pointerX,y:a.pointerY})),setTimeout(i,a.syncPointerDataFrequency)}function s(t){a.openConnection(t,a.token);var e=Object.assign({},a.config);delete e.ws,delete e.containerEl;var i={cmd:"open",user_id:a.UID,user_color:a.COLOR,room_token:a.token,room_password:a.password,room_config:e,viewportX:parseFloat(a.viewportX)||0,viewportY:parseFloat(a.viewportY)||0,width:parseFloat(a.width)||0,height:parseFloat(a.height)||0,viewportScale:parseFloat(a.scale)||1,viewportZRotation:parseFloat(a.rotation)||0},s=JSON.stringify(i);a.ws.send(s),a.dispatch("initConnection")}e.call(this,t),console.log("sketchpad.js","Sketchpad::constructor",t);var o=f(6),r=h();t.features||(t.features="*"),this.initialised=!1,this.drawingPaused=!1,this.pausedQueue=[],this.displayCrosshair=!0,this.displayGrid=!1,this.UID=o[0].toUpperCase()+o.substr(1),this.user={},this.COLOR=r,this.editorsCount=0,this.viewersCount=0,this.resources=new p({sketchpad:this}),t=t||{},X.watermarkImageSrc&&(this.watermark=new Image,this.watermark.src=X.watermarkImageSrc,this.watermark.title=X.watermarkTitle,this.watermark.alt="sketchpad.pro",this.watermark.style.cursor="help",this.watermark.onload=function(){var t=this;t.addEventListener("click",function(){alert(t.title)})},this.watermark.style.position="absolute",this.watermark.style.right="0px",this.watermark.style.bottom="0px",this.watermark.crossOrigin="anonymous"),this.password=t.password||"",this.setMetaConfigFreeze=NaN,this.config=t,this.token=t.token||"#public",this.ws=t.ws||{addEventListener:function(){},send:function(){}},this.containerEl=t.containerEl||document.body,this.progressParentEl=t.progressParentEl||this.containerEl,this.syncNetworkDataFrequency=t.syncNetworkDataFrequency||Math.round(1e3),this.syncPointerDataFrequency=t.syncPointerDataFrequency||Math.round(100),this.centerViewport=!0,this.readOnly=t.readOnly||!1,this.tools={},this.tool=null,this.viewportX=parseFloat(t.viewportX)||0,this.viewportY=parseFloat(t.viewportY)||0,this.scale=parseFloat(t.viewportScale)||1,this.rotation=parseFloat(t.viewportZRotation)||0,this.LAYER_FRONT="F",this.LAYER_BACK="B",this.receivingHistory=!1,this.inputs={},this.backgroundCanvas=document.createElement("canvas"),this.backgroundCanvas.style.width="100%",this.backgroundCanvas.style.height="100%",this.backgroundCanvas.style.position="absolute",this.backgroundCanvas.style.transformOrigin="0 0",this.backgroundCanvas.style.webkitTransformOrigin="0 0",this.backgroundCanvas.style.MozTransformOrigin="0 0",this.backgroundCanvas.style.msTransformOrigin="0 0",this.backgroundCanvas.style.OTransformOrigin="0 0",this.containerEl.appendChild(this.backgroundCanvas),this.backgroundIFrame=document.createElement("iframe"),this.backgroundIFrame.style.display="none",this.backgroundIFrame.style.position="absolute",this.backgroundIFrame.style.transformOrigin="0 0",this.backgroundIFrame.style.webkitTransformOrigin="0 0",this.backgroundIFrame.style.MozTransformOrigin="0 0",this.backgroundIFrame.style.msTransformOrigin="0 0",this.backgroundIFrame.style.OTransformOrigin="0 0",this.backgroundIFrame.style.border=0,this.containerEl.appendChild(this.backgroundIFrame),this.background=document.createElement("img"),this.background.style.position="absolute",this.background.style.transformOrigin="0 0",this.background.style.webkitTransformOrigin="0 0",this.background.style.MozTransformOrigin="0 0",this.background.style.msTransformOrigin="0 0",this.background.style.OTransformOrigin="0 0",this.containerEl.appendChild(this.background),this.hudsEl=document.createElement("div"),this.hudsEl.style.zIndex=1,this.hudsEl.style.width="100%",this.hudsEl.style.height="100%",this.hudsEl.style.position="absolute",this.hudsEl.style.backgroundPosition="center center",this.hudsEl.style.transformOrigin="0 0",this.hudsEl.style.webkitTransformOrigin="0 0",this.hudsEl.style.MozTransformOrigin="0 0",this.hudsEl.style.msTransformOrigin="0 0",this.hudsEl.style.OTransformOrigin="0 0",this.hudsEl.style.transition="opacity .5s",this.containerEl.appendChild(this.hudsEl),this.projectorEl=document.createElement("div"),this.projectorEl.style.zIndex=2,this.projectorEl.style.width="100%",this.projectorEl.style.height="100%",this.projectorEl.style.position="absolute",this.projectorEl.style.backgroundPosition="center center",this.projectorEl.style.transformOrigin="0 0",this.projectorEl.style.webkitTransformOrigin="0 0",this.projectorEl.style.MozTransformOrigin="0 0",this.projectorEl.style.msTransformOrigin="0 0",this.projectorEl.style.OTransformOrigin="0 0",this.pointerEl=document.createElement("div"),this.pointerEl.position="absolute",this.pointerEl.display="none",this.projectorEl.appendChild(this.pointerEl),this.containerEl.appendChild(this.projectorEl),this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.canvasB=document.createElement("canvas"),this.canvasB.style.width="100%",this.canvasB.style.height="100%",this.canvasB.style.position="absolute",this.canvasProjector=document.createElement("canvas"),this.canvasProjector.style.width="100%",this.canvasProjector.style.height="100%",this.canvasProjector.style.position="absolute",this.objectsCanva=document.createElement("div"),this.objectsCanva.style.width="100%",this.objectsCanva.style.height="100%",this.objectsCanva.style.position="absolute",this.foreground=document.createElement("img"),this.foreground.style.position="absolute",this.foreground.style.transformOrigin="0 0",this.foreground.style.webkitTransformOrigin="0 0",this.foreground.style.MozTransformOrigin="0 0",this.foreground.style.msTransformOrigin="0 0",this.foreground.style.OTransformOrigin="0 0",this.crosshairEl=document.createElement("div"),this.crosshairEl.className="crosshair",this.crosshairEl.style.position="absolute",this.crosshairEl.style.transformOrigin="0 0",this.crosshairEl.style.webkitTransformOrigin="0 0",this.crosshairEl.style.MozTransformOrigin="0 0",this.crosshairEl.style.msTransformOrigin="0 0",this.crosshairEl.style.OTransformOrigin="0 0",this.crosshairEl.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QAQAA9AFN/YZW7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH4AoTDyESpvZyZAAAANxJREFUWMPtllEKwjAQRF+ipghKFVqhXs/jeAbvIOKpLMUfQVpt4k8LIkULsSxiBvZr2c0wO7sEAgICfh3Hw34t+f4S2Po00F8gsQKMJAElqoAxBuAuReAex3Ep7QErTcAL4z5jbuXuqJ055zSwAG5v+p59HLwDJgBpmgKUjezKOTdSSk2ttVetdQ24RtUoz/O2/gZsfI/Nc8yfIkuSZAdkjVL6JcynG9FnBOc3uVIpVQMXoOrIV4OvYSP7726Blu7hTcBaG/X00iAExkVRiI9A1IQVcPrrL1lAgDceLw8ximVPrtAAAAAASUVORK5CYII=')",this.loadingEl=document.createElement("div"),this.loadingEl.style.position="absolute",this.loadingEl.style.display="flex",this.loadingEl.style.width="100%",this.loadingEl.style.height="100%",this.loadingEl.style.backgroundColor="rgba(255, 255, 255, .4)",this.loadingEl.textContent="...please wait...",this.loadingEl.style.color="#000",this.loadingEl.style.justifyContent="center",this.loadingEl.style.alignItems="center",this.containerEl.style.position="relative",this.containerEl.style.overflow="hidden",this.containerEl.appendChild(this.canvasB),this.containerEl.appendChild(this.objectsCanva),this.containerEl.appendChild(this.canvas),this.containerEl.appendChild(this.canvasProjector),this.watermark&&this.containerEl.appendChild(this.watermark),this.containerEl.appendChild(this.foreground),this.containerEl.appendChild(this.crosshairEl),this.containerEl.appendChild(this.loadingEl),this.width=0,this.height=0,this.windowWidth=0,this.windowHeight=0,this.room=new v(this.token,this),this.away=!1;var a=this;return X.avaliableTools.forEach(function(t){a.registerTool(t.prototype.toolId,t,{})}),this.setTool(X.defaultTool),setTimeout(function(){if(a.clearSketchpad(),a.createEventsDraw(),a.syncNetworkData(),i(),a.syncCanvasFrame(),a.setMetaConfig(t,!1),a.ws.addEventListener("message",function(t){a.receiveMessageFromServer(t)},!0),1===a.ws.readyState?s():a.ws.addEventListener("open",s,!0),a.initialised=!0,a.config.createPageConfig){var e=a.room.addSketch(a,a.config.createPageConfig);a.room.setActiveSketch(a,e)}a.dispatch("initialised",this)},0),this}function v(t,e){
if(!(e instanceof y))throw new Error("Room(room_token, sketchpad)",t,"sketchpad must be instanceof Sketchpad.");return this.sketchpad=e,this.room_token=t,this.sketches=[],this.prevSketch=[],this.totalCount=0,this.clients=[],e.room=this,this}function m(t){return e.call(this,t),this.config=Object.assign({sid:String(Date.now()+Math.random()),cts:Date.now()},t),this.toolsCache=[],this.framesHistory=[],this.newFrames=[],this.myStash=[],this.bulkId=0,this.grindingThreshold=1e3/60,this.userBFramesCounter=0,this.setConfig(this.config),this}function w(t){if(e.call(this,t),!t)return this;if(!(t.sketchpad instanceof y))throw console.warn("config.sketchpad must be instanceof Sketchpad"),new Error("config.sketchpad must be instanceof Sketchpad");this.sketchpad=t.sketchpad,t.toolId&&(this.toolId=t.toolId),t.lineWidth&&(this.lineWidth=t.lineWidth),t.layers&&(this.layers=t.layers),t.color&&(this.color=t.color)}function k(t){w.call(this,t)}function b(t){k.call(this,t)}function x(t){k.call(this,t),this.toolId=t.toolId||"colorpicker",this.layers=[]}function C(t){w.call(this,t)}function E(t){w.call(this,t),this.toolId=t.toolId||"cutout"}function I(t){w.call(this,t)}function A(t){w.call(this,t)}function S(t){w.call(this,t);var e=this;this.emptyImage=document.createElement("img"),this.emptyImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAArrAAAK6wGCiw1aAAAAB3RJTUUH4QQJFQY3bU7o3wAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAACR0lEQVR42uWbsU7rMBSG//ObMRkQguVKvAHv/wrsvEGlLiDUIdHd7MNAkHp7AzSJ7WM7lrK0Q+Uv+b6kR4oAeAbwAkCmYw9Lp+PpZtr8X+/9iaTuYfchBHHO3QJ4IQDx3p+cc/c7Oftwzt17708AhACEpKrqq4g8tr55EXlU1dfpahf+I4bqoWUI0+YP55/xvzp8QngYx9G1svFxHJ2IPFxufhYAAAzD8N73/V0rAPq+vxuG4X3uu1kAXdf5Vprw5XzXdf5qAK00Yc75RQBqbcJPzi8GUGMTfnJ+FYCamvCb86sA1NKEa5zfBKDUJixxfjOAEpuwxPkoAEpqwlLnowAopQlrnI8KwKoJW5yPDsCiCVucTwIgZxO2Op8EQK4mxHA+KYBUTYjpfHIAKZoQ0/ksAGI2IbbzWQDEakIK57MCWNuElM5nB7CmCSmdNwGwpAmpnTcBcG0TcjhvCuC7JuR03hzAXBNyOn+5bix+9KwJf6ar4mj1l5rY+TIBcOb8UVWPljNGEwCXzlvOGLMDmLvPW84YabD5g9U8wQzAkvt87hkjLZzPPU8wBbDm2T5nE2jpfOp5ghmAmM/2qZvAEpy3bAJLcN6yCSzJeYsmsDTnczeBJTqfswks0fmcTWDJzudoAkt3PnUTWIPzKZvAGpxP2QTW5HyKJrA252M3gTU6H7MJrNH5mE1gzc7HaAJrd35rE9iC81uawBac39IEtuT8miYQgIYQpBXnr21CCEEAKAGoc+7We/+GnSzv/dv08rQKdv76/Af/G22JqgLBTAAAAABJRU5ErkJggg==";var i=this.sketchpad;document.addEventListener("paste",function(t){if(!e.disabled){var s=t.clipboardData&&t.clipboardData.items||t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items;Object.keys(s).forEach(function(t){var o=s[t];if("file"===o.kind){var r=o.getAsFile();window.tmp=new n({progressParentEl:i.progressParentEl||i.containerEl,file:r}).on("success",function(t){e.onImagehostReady(t.url,0,0,0,0,!0)}).on("error",e.onImagehostError.bind(e))}})}}),this.sketchpad.containerEl.addEventListener("dragover",function(t){e.disabled||t.preventDefault()}),this.sketchpad.containerEl.addEventListener("dragenter",function(t){e.disabled}),this.sketchpad.containerEl.addEventListener("drop",function(t){if(!e.disabled){var s=e.sketchpad.mainPos(t.clientX,t.clientY),o=t.dataTransfer.getData("URL");if(o)return window.tmp=new n({progressParentEl:i.progressParentEl||i.containerEl,url:o}).on("success",function(t){e.onImagehostReady(t.url,s.x,s.y,s.x,s.y)}).on("error",e.onImagehostError.bind(e)),void t.preventDefault();var r=t.dataTransfer.getData("text/html"),a=r.match(/<img.+src\=(?:\"|\')(.+?)(?:\"|\')(?:.+?)>/);if(a&&a[1]){var l=document.createElement("span");return l.innerHTML=a[1],console.log("URL PARSED",encodeURI(l.textContent)),window.tmp=new n({progressParentEl:i.progressParentEl||i.containerEl,url:encodeURI(l.textContent)}).on("success",function(t){e.onImagehostReady(t.url,s.x,s.y,s.x,s.y)}).on("error",e.onImagehostError.bind(e)),void t.preventDefault()}var h=t.dataTransfer.files;if(h.length>0){var c=h[0];return void 0===FileReader||-1===c.type.indexOf("image")&&-1===c.type.indexOf("pdf")||(window.tmp=new n({progressParentEl:i.progressParentEl||i.containerEl,file:c}).on("success",function(t){e.onImagehostReady(t.url,s.x,s.y,s.x,s.y)}).on("error",e.onImagehostError.bind(e))),void t.preventDefault()}}})}function T(t){w.call(this,t),this.toolId=t.toolId||"line"}function P(t){w.call(this,t)}function M(t){w.call(this,t),this.toolId=t.toolId||"move-viewport",this.layers=[]}function D(t){w.call(this,t),this.toolId=t.toolId||"null",this.layers=[]}function O(t){w.call(this,t)}function z(t){w.call(this,t)}function F(t){k.call(this,t)}function L(t){w.call(this,t),this.toolId=t.toolId||"rotate-viewport",this.layers=[]}function B(t){w.call(this,t),this.toolId=t.toolId||"type"}function R(t){function i(t){var e=a.normalize(t.offsetY,0,a.height),i=a.minValue+e/a.height*(a.maxValue-a.minValue);a.setSize(i)}function s(t){a.setSize(a.size-t.deltaY/2),t.preventDefault()}e.call(this,t),"object"!=typeof t.keyModifiers&&(t.keyModifiers={});var r=t.containerEl;this.containerEl=r,r.classList.add("thickness");this.minValue=t.minValue||.01,this.maxValue=t.maxValue||20,this.width=20,this.height=220,this.size=t.size||1,r.style.position="relative",r.style.width="20px",r.style.height="220px",r.style.display="inline-block",this.bgEl=document.createElement("div"),this.bgEl.style.backgroundColor="transparent",this.bgEl.style.position="absolute",this.bgEl.className="bg",this.bgEl.style.top="0px",this.bgEl.style.left="0px",this.bgEl.style.cursor="row-resize",this.bgEl.style.borderLeft="20px solid transparent",this.bgEl.style.borderBottom="220px solid black",this.sliderEl=document.createElement("div"),this.sliderEl.className="slider hue-slider",this.sliderEl.style.width="24px",this.sliderEl.style.height="6.6px",this.sliderEl.style.position="absolute",this.sliderEl.style.top="22px",this.sliderEl.style.left="-2px",this.sliderEl.style.backgroundColor="white",this.sliderEl.style.cursor="row-resize",this.sliderEl.style.boxShadow="inset 0 0 2px #000",this.sliderEl.style.zIndex="100",this.sizeInput=document.createElement("input"),this.sizeInput.title="S:",this.keyshortcuts=new l;var a=this;r.appendChild(this.bgEl),r.appendChild(this.sliderEl),o(this.bgEl,"slide",i),this.bgEl.addEventListener("wheel",s),this.sliderEl.addEventListener("wheel",s),this.keyshortcuts.addShortcut(Object.assign({shiftKey:!1,keyCode:38,repeatable:!0},t.keyModifiers),function(){var t=a.size;t=a.size<=1?Math.round(10*t-1)/10:Math.round(t-1),a.setSize(t)}),this.keyshortcuts.addShortcut(Object.assign({shiftKey:!1,keyCode:40,repeatable:!0},t.keyModifiers),function(){var t=a.size;t=a.size<1?Math.round(10*t+1)/10:Math.round(t+1),a.setSize(t)})}e.prototype={on:function(t,e){return this.registeredCallbacks[t]||(this.registeredCallbacks[t]=[]),this.registeredCallbacks[t].push(e),this},removeListener:function(t,e){if(this.registeredCallbacks[t]){var i;for(i=this.registeredCallbacks[t].length-1;i>=0;i-=1)this.registeredCallbacks[t][i]===e&&this.registeredCallbacks[t].splice(i,1);this.registeredCallbacks[t].indexOf(e)}},once:function(t,e,i){this.registeredCallbacksOnce[t]||(this.registeredCallbacksOnce[t]=[]);var s=!1;return i&&this.registeredCallbacksOnce[t].forEach(function(t){if(t.id===i)return t.fn=e,void(s=!0)}),s||this.registeredCallbacksOnce[t].push({id:i,fn:e}),this},dispatch:function(t,e,i,s){var o=this;return this.registeredCallbacks[t]&&this.registeredCallbacks[t].forEach(function(t){t.call(o,e,i,s)}),this.registeredCallbacksOnce[t]&&(this.registeredCallbacksOnce[t].forEach(function(t){t.fn.call(o,e,i,s)}),delete this.registeredCallbacksOnce[t]),this}},window.Eventsmanager=e,i.prototype=Object.create(e.prototype),Object.assign(i.prototype,{normalize:function(t,e,i){return t<e&&(t=e),t>i&&(t=i),t},pickPalette:function(t,e){t=this.normalize(t,0,100),e=this.normalize(e,0,100),this.color.saturation=t,this.color.value=e;var i=this.HSVtoRGB(this.color.hue,this.color.saturation,this.color.value);this.setPalettePointer(this.color.saturation,this.color.value);var s=i;s.a=this.color.alpha,this.setColor(s)},changeHue:function(t){t%=360,t<0&&(t+=360),this.setHueSlider(t),this.color.hue=t,this.drawPalette(t);var e=this.HSVtoRGB(t,this.color.saturation,this.color.value);e.a=this.color.alpha,this.setColor(e)},changeAlpha:function(t){t=this.normalize(t,0,1),this.color.alpha=t,this.setAlpha(t)},focus:function(){this.isFocused=!0},blur:function(){this.isFocused=!1},getColor:function(){return{red:parseInt(this.color.red,10),green:parseInt(this.color.green,10),blue:parseInt(this.color.blue,10),alpha:parseFloat(this.color.alpha)}},HSVtoRGB:function(t,e,i){var s=e/100,o=i/100,r=s*o,a=t/60,n=r*(1-Math.abs(a%2-1)),l=o-r;return r=255*(r+l),n=255*(n+l),l*=255,a>=0&&a<1?{r:r,g:n,b:l}:a>=1&&a<2?{r:n,g:r,b:l}:a>=2&&a<3?{r:l,g:r,b:n}:a>=3&&a<4?{r:l,g:n,b:r}:a>=4&&a<5?{r:n,g:l,b:r}:a>=5&&a<6?{r:r,g:l,b:n}:{r:0,g:0,b:0}},RGBtoHSV:function(t,e,i){var s=t/255,o=e/255,r=i/255,a=Math.max(s,o,r),n=Math.min(s,o,r),l=a-n,h=0,c=0;l&&(a===s&&(h=(o-r)/l),a===o&&(h=2+(r-s)/l),a===r&&(h=4+(s-o)/l),a&&(c=l/a));var d,p,u;return d=60*h,d<0&&(d+=360),p=100*c,u=100*a,{h:d,s:p,v:u}},putPixel:function(t,e,i,s){var o=4*(e+i*t.width);t.data[o]=s.r,t.data[o+1]=s.g,t.data[o+2]=s.b,t.data[o+3]=s.a},drawHue:function(){var t,e,i;for(t=0;t<this.hueCanvas.width;t+=1)for(e=0;e<this.hueCanvas.height;e+=1)i=this.HSVtoRGB(e/this.hueCanvas.height*360,100,100),this.putPixel(this.hueIData,t,e,{r:i.r,g:i.g,b:i.b,a:255});this.hueContext2d.putImageData(this.hueIData,0,0)},setAlphaSlider:function(t){this.alphaSliderEl.style.left=this.alphaCanvas.width*(t/1)-.015*this.width+"px"},setAlpha:function(t){t=Math.round(100*t)/100,this.color.alpha=t,this.setColor({r:this.color.red,g:this.color.green,b:this.color.blue,a:this.color.alpha})},setHueSlider:function(t){this.hueSliderEl.style.top=this.height*(1/11)+this.hueCanvas.height*(t/360)-.015*this.height+"px"},setPalettePointer:function(t,e){var i=this.paletteCanvas.width*(t/100),s=this.paletteCanvas.height*(e/100);this.palettePointerEl.style.left=.03*-this.width+i+"px",this.palettePointerEl.style.top=.03*-this.height+.1*this.height+s+"px"},triggerUpdate:function(){var t=this.getColor();this.dispatch("change",{color:t})},updateFromInputs:function(){this.setColor({r:this.redInput.value,g:this.greenInput.value,b:this.blueInput.value,a:this.alphaInput.value}),this.setAlpha(this.alphaInput.value)},setColor:function(t,e){var i={h:this.color.hue,s:this.color.saturation,v:this.color.value};(t.r||t.g||t.b)&&(i=this.RGBtoHSV(t.r,t.g,t.b)),t.r===t.g&&t.g===t.b&&(i.h=this.color.hue),this.color.red=t.r,this.color.green=t.g,this.color.blue=t.b,this.color.alpha=t.a,this.color.hue=i.h,this.color.saturation=i.s,this.color.value=i.v,this.redInput.value=t.r,this.greenInput.value=t.g,this.blueInput.value=t.b,this.alphaInput.value=t.a,this.setHueSlider(i.h),this.drawPalette(i.h),this.darwAlpha(t),this.setAlphaSlider(t.a),this.setPalettePointer(i.s,i.v);var s=this.getColor();this.colorEl.style.backgroundColor="rgba("+s.red+","+s.green+","+s.blue+","+s.alpha+")",e||this.triggerUpdate()},drawPalette:function(t){var e,i,s;for(e=0;e<this.paletteCanvas.width;e+=1)for(i=0;i<this.paletteCanvas.height;i+=1)s=this.HSVtoRGB(t,e/this.paletteCanvas.width*100,i/this.paletteCanvas.height*100),this.putPixel(this.paletteIData,e,i,{r:s.r,g:s.g,b:s.b,a:255});this.paletteContext2d.putImageData(this.paletteIData,0,0)},darwAlpha:function(t){var e,i;for(e=0;e<this.alphaCanvas.width;e+=1)for(i=0;i<this.alphaCanvas.height;i+=1)this.putPixel(this.alphaIData,e,i,{r:t.r,g:t.g,b:t.b,a:e/this.alphaCanvas.width*255});this.alphaContext2d.putImageData(this.alphaIData,0,0)}}),window.Colorpalette=i;var j=!1;try{var Y=Object.defineProperty({},"passive",{get:function(){j=!0}});window.addEventListener("test",null,Y)}catch(t){console.log("ignore",t)}window.supportsPassive=j,window.addEvent=o,r.prototype=Object.create(e.prototype),Object.assign(r.prototype,{normalize:function(t,e,i){return t<e&&(t=e),t>i&&(t=i),t},setSize:function(t){this.size=this.normalize(t,this.minSize,this.maxSize),this.sizeSliderEl.style.left=this.width*(this.size-this.minSize)/(this.maxSize-this.minSize)+"px",this.redrawPreview(),this.dispatch("change",{size:this.size})},setFont:function(t){this.font=t,this.fontListSelectEl.value=t,this.dispatch("change",{font:this.font}),this.redrawPreview()},setColor:function(t){this.color=t,this.redrawPreview()},redrawPreview:function(){var t=this.previewContext2d;t.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),t.font=this.size+"px "+this.font,t.textAlign="left",t.textBaseline="middle",t.fillStyle="rgba("+this.color.r+","+this.color.g+","+this.color.b+","+this.color.a+")",t.fillText("Lorem ipsum",0,this.previewCanvas.height/2)}}),window.Fontpalette=r,a.prototype=Object.create(e.prototype),Object.assign(a.prototype,{inputs:{},setInputValue:function(t,e){if(this.inputs&&this.inputs[t]&&this.inputs[t].inputEl){var i=this.inputs[t];switch(i.type){case"checkbox":i.inputEl.checked=e;break;default:i.inputEl.value=e}}},addInput:function(t){var e=document.createElement("div");e.style.marginBottom="8px";var i=document.createElement("span");i.style.padding="0",i.style.margin="0",i.style.fontSize="12px",i.style.lineHeight="12px",i.style.display="block",i.textContent=t.title,i.style.marginBottom="2px";var s=document.createElement("input");switch(s.type=t.type||"text",s.name=t.name||"",s.style.width="48px",s.type){case"checkbox":s.style.height="14px",s.style.width="14px",s.style.lineHeight="20px"}s.minValue=t.minValue,s.maxValue=t.maxValue,s.value=t.value,"function"==typeof t.onChange&&s.addEventListener("change",t.onChange),e.appendChild(i),e.appendChild(s),this.containerEl.appendChild(e),this.inputs[s.name]={name:s.name,type:s.type,groupEl:e,labelEl:i,inputEl:s}}}),window.Formpalette=a,n.prototype=Object.create(e.prototype),Object.assign(n.prototype,{isDataURL:function(t){return!!t.match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i)},dataURItoFile:function(t){if("string"!=typeof t)return void this.dispatch("error",{type:"upload",message:"dataURI must be a string."});t=t.split(",");var e,i=t[0].split(":")[1].split(";")[0],s=atob(t[1]),o=s.length,r=new ArrayBuffer(o),a=new Uint8Array(r);for(e=0;e<o;e+=1)a[e]=s.charCodeAt(e);return new File([a],"file",{type:i})},proxyUrl:function(t){function e(t){setTimeout(function(){s.dispatch("success",{status:"ok",url:t})},0)}var i=document.createElement("a");i.href=t;var s=this;e(-1!==String(i.hostname).indexOf(this.proxyExcludedDomain)?t:this.proxyImageUrl+"?url="+encodeURIComponent(t))},uploadProgress:function(t){this.dispatch("progress",t.loaded/t.total)},uploadFile:function(t){this.File=t,(new FormData).append("fileToUpload",t);var e=new XMLHttpRequest,i=this;e.upload.addEventListener("progress",function(t){i.uploadProgress(t),i.progressbar.uploadProgress(t)},!1),e.addEventListener("load",function(t){console.log("uploading load",t),i.uploadComplete(t),i.progressbar.uploadComplete(t)},!1),e.addEventListener("error",function(t){console.log("uploading error",t),i.uploadFailed(t),i.progressbar.uploadFailed(t)},!1),e.addEventListener("abort",function(t){i.uploadCanceled(t),i.progressbar.uploadCanceled(t)},!1);var s;switch(String(t.type)){case"application/pdf":s=this.postPdfUrl;break;default:s=this.postImageUrl}e.open("POST",s),e.setRequestHeader("Content-Type",t.type),e.setRequestHeader("Content-Name",encodeURI(t.name)),e.setRequestHeader("Content-Size",t.size),e.setRequestHeader("Content-LastModified",t.lastModified),e.send(t),this.dispatch("upload",e)},uploadComplete:function(t){var e={};try{e=JSON.parse(t.target.response)}catch(t){this.dispatch("error",{type:"parse",title:"Upload fail",message:"Uknown response from server.",err:t})}e&&"ok"===e.status?this.dispatch("success",e):this.dispatch("error",{type:"response",title:"Upload fail",message:e&&e.message||"Your upload was rejected by server.",response:e})},uploadFailed:function(t){console.error("uploadFailed",t),this.dispatch("error",{type:"fail",title:"Upload fail",message:"There was an error attempting to upload the file.",e:t})},uploadCanceled:function(t){this.dispatch("error",{type:"cancelled",title:"Upload cancelled",message:"The upload has been canceled by the user or the browser dropped the connection.",e:t})}}),window.Imagehost=n,l.prototype=Object.create(e.prototype),Object.assign(l.prototype,{disabled:!1,disable:function(){"use strct";this.disabled=!0},enable:function(){"use strct";this.disabled=!1},isMac:function(){"use strct";return-1!==navigator.appVersion.indexOf("Mac")},checkIfPressed:function(t,e){return("optional"===t.metaKey||!!t.metaKey==!!e.metaKey)&&(("optional"===t.altKey||!!t.altKey==!!e.altKey)&&(("optional"===t.shiftKey||!!t.shiftKey==!!e.shiftKey)&&(("optional"===t.ctrlKey||!!t.ctrlKey==!!e.ctrlKey)&&t.keyCode===e.keyCode)))},onKeyDown:function(t){if(this.disabled)return!1;var e,i;for(e=0;e<this.shortcuts.length;e+=1)i=this.shortcuts[e],i.pressed&&!i.repeatable||!this.checkIfPressed(i,t)||(i.pressed=!0,"function"==typeof i.callbackDown&&i.callbackDown(t))},onKeyUp:function(t){if(this.disabled)return!1;var e,i;for(e=0;e<this.shortcuts.length;e+=1)i=this.shortcuts[e],i.pressed&&(this.checkIfPressed(i,t),!0)&&(i.pressed=!1,"function"==typeof i.callbackUp&&i.callbackUp(t))},registerEvents:function(){var t=this;window.addEventListener("keydown",function(e){if("INPUT"!==document.activeElement.tagName)return t.onKeyDown(e)}),window.addEventListener("keyup",function(e){if("INPUT"!==document.activeElement.tagName)return t.onKeyUp(e)})},getKeycodeStr:function(t){var e;switch(t){case 32:e="space";break;case 91:e=this.isMac()?"⌘":"WIN";break;case 18:e=this.isMac()?"⌥":"ALT";break;case 16:e=this.isMac()?"⇪":"SHIFT";break;case 17:e=this.isMac()?"ctrl":"CTRL";break;case 27:e="Esc";break;case 20:e=this.isMac()?"⇪":"Caps lock";break;case 13:e="⏎";break;case 8:e="⌫";break;case 187:e="+";break;case 189:e="-";break;default:e=String.fromCharCode(t)}return e},getShortcutStr:function(t){var e=[];return!0===t.metaKey&&e.push(this.isMac()?"⌘":"WIN"),!0===t.altKey&&e.push(this.isMac()?"⌥":"ALT"),!0===t.ctrlKey&&e.push(this.isMac()?"ctrl":"CTRL"),!0===t.shiftKey&&e.push(this.isMac()?"⇪":"SHIFT"),t.keyCode&&e.push(this.getKeycodeStr(t.keyCode)),e.join(" + ")},addShortcut:function(t,e,i){t.callbackDown=e,t.callbackUp=i,this.shortcuts.push(t)}}),window.Keyshortcuts=l,window.randomColor=h;var X={avaliableTools:[],defaultTool:"pen",watermarkTitle:"sketchpad.pro library is available under AGPL-3 license, visit http://developers.sketchpad.pro for source code. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.",
watermarkImageSrc:'data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg    xmlns:dc="http://purl.org/dc/elements/1.1/"    xmlns:cc="http://creativecommons.org/ns#"    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"    xmlns:svg="http://www.w3.org/2000/svg"    xmlns="http://www.w3.org/2000/svg"    xmlns:xlink="http://www.w3.org/1999/xlink"    xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"    xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"    width="128"    height="18"    viewBox="0 0 294.79549 53.369998"    id="svg2"    version="1.1"    inkscape:version="0.91 r13725"    sodipodi:docname="sketchpad-logo-clean.svg">   <sodipodi:namedview      pagecolor="#ffffff"      bordercolor="#666666"      borderopacity="1"      objecttolerance="10"      gridtolerance="10"      guidetolerance="10"      inkscape:pageopacity="0"      inkscape:pageshadow="2"      inkscape:window-width="1296"      inkscape:window-height="719"      id="namedview51"      showgrid="true"      inkscape:zoom="6.416994"      inkscape:cx="72.420486"      inkscape:cy="4.2725026"      inkscape:window-x="99"      inkscape:window-y="0"      inkscape:window-maximized="0"      inkscape:current-layer="layer1">     <inkscape:grid        type="xygrid"        id="grid3441" />   </sodipodi:namedview>   <defs      id="defs4">     <linearGradient        id="rainbow"        inkscape:collect="always">       <stop          offset="0"          style="stop-color:#ff0101;stop-opacity:1"          id="stop6" />       <stop          offset="0.04"          style="stop-color:#ff7901;stop-opacity:1"          id="stop8" />       <stop          offset="0.12"          style="stop-color:#fff001;stop-opacity:1"          id="stop10" />       <stop          offset="0.20"          style="stop-color:#96ff01;stop-opacity:1"          id="stop12" />       <stop          offset="0.27"          style="stop-color:#1fff01;stop-opacity:1"          id="stop14" />       <stop          offset="0.34"          style="stop-color:#01ff5b;stop-opacity:1"          id="stop16" />       <stop          offset="0.41"          style="stop-color:#01ffd2;stop-opacity:1"          id="stop18" />       <stop          offset="0.51"          style="stop-color:#01b4ff;stop-opacity:1"          id="stop20" />       <stop          offset="0.56"          style="stop-color:#013dff;stop-opacity:1"          id="stop22" />       <stop          offset="0.67"          style="stop-color:#3d01ff;stop-opacity:1"          id="stop24" />       <stop          offset="0.78"          style="stop-color:#b401ff;stop-opacity:1"          id="stop26" />       <stop          offset="0.87"          style="stop-color:#ff01d2;stop-opacity:1"          id="stop28" />       <stop          offset="0.95"          style="stop-color:#ff015b;stop-opacity:1"          id="stop30" />       <stop          offset="1"          style="stop-color:#ff0101;stop-opacity:1"          id="stop32" />     </linearGradient>     <linearGradient        xlink:href="#rainbow"        id="linearGradientRainbow"        gradientUnits="userSpaceOnUse"        x1="45"        y1="143"        x2="413"        y2="143"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3379"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3381"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3383"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3385"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3387"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3389"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3391"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3393"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3395"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3397"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3399"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />     <linearGradient        inkscape:collect="always"        xlink:href="#rainbow"        id="linearGradient3401"        gradientUnits="userSpaceOnUse"        gradientTransform="matrix(0.98959455,0,0,1.1096972,279.05272,-122.63917)"        x1="45"        y1="143"        x2="413"        y2="143" />   </defs>   <metadata      id="metadata35">     <rdf:RDF>       <cc:Work          rdf:about="">         <dc:format>image/svg+xml</dc:format>         <dc:type            rdf:resource="http://purl.org/dc/dcmitype/StillImage" />         <dc:title></dc:title>         <dc:publisher>           <cc:Agent>             <dc:title></dc:title>           </cc:Agent>         </dc:publisher>         <dc:rights>           <cc:Agent>             <dc:title>AGPL</dc:title>           </cc:Agent>         </dc:rights>         <dc:creator>           <cc:Agent>             <dc:title>positivestuido.co</dc:title>           </cc:Agent>         </dc:creator>         <dc:date>2017</dc:date>         <dc:subject>           <rdf:Bag>             <rdf:li>sketch drawing board real-time canvas surface</rdf:li>           </rdf:Bag>         </dc:subject>       </cc:Work>     </rdf:RDF>   </metadata>   <g      inkscape:label="Layer 1"      inkscape:groupmode="layer"      id="layer1"      transform="translate(-359.92474,-9.2357351)">     <path        inkscape:connector-curvature="0"        id="path4215"        style="fill:url(#linearGradientRainbow);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 348.50715,25.511773 0,5.415323 -1.78128,0 0,-3.417866 -16.30852,0 0,7.412776 18.0898,0 0,11.407687 -24.70029,0 0,-5.415322 1.78127,0 0,3.417866 16.30852,0 0,-7.412776 -18.08979,0 0,-11.407688 24.70029,0 z" />     <path        inkscape:connector-curvature="0"        id="path4217"        style="fill:url(#linearGradient3401);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 380.66401,44.332237 0,1.997456 -9.65843,0 0,-1.997456 3.04795,0 -4.71047,-7.412776 -7.32301,0 0,7.412776 3.95839,0 0,1.997456 -14.48766,0 0,-1.997456 3.91879,0 0,-26.854671 -3.91879,0 0,-1.997453 10.52927,0 0,19.441893 7.28343,0 4.39379,-7.412776 -3.20628,0 0,-1.997457 9.65844,0 0,1.997457 -4.31462,0 -4.94798,8.344922 5.3834,8.478085 4.39378,0 z" />     <path        inkscape:connector-curvature="0"        id="path4219"        style="fill:url(#linearGradient3399);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 384.07627,25.511773 24.70027,0 0,11.407688 -18.08978,0 0,7.412776 16.30851,0 0,-3.417866 1.78127,0 0,5.415322 -24.70027,0 0,-20.81792 z m 6.61049,1.997457 0,7.412776 16.30851,0 0,-7.412776 -16.30851,0 z" />     <path        inkscape:connector-curvature="0"        id="path4221"        style="fill:url(#linearGradient3397);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 429.88582,44.332237 0,1.997456 -14.25015,0 0,-18.820463 -3.91879,0 0,-1.997457 3.91879,0 0,-10.03166 6.61049,0 0,10.03166 7.63966,0 0,1.997457 -7.63966,0 0,16.823007 7.63966,0 z" />     <path        inkscape:connector-curvature="0"        id="path4223"        style="fill:url(#linearGradient3395);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 456.01112,40.914371 1.78128,0 0,5.415322 -24.70029,0 0,-20.81792 24.70029,0 0,5.415323 -1.78128,0 0,-3.417866 -16.30851,0 0,16.823007 16.30851,0 0,-3.417866 z" />     <path        inkscape:connector-curvature="0"        id="path4225"        style="fill:url(#linearGradient3393);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 493.35532,44.332237 0,1.997456 -10.25221,0 0,-1.997456 4.23547,0 0,-16.823007 -16.3085,0 0,16.823007 3.91879,0 0,1.997456 -14.44809,0 0,-1.997456 3.91879,0 0,-26.854671 -3.91879,0 0,-1.997453 10.5293,0 0,10.03166 18.08978,0 0,18.820464 4.23546,0 z" />     <path        inkscape:connector-curvature="0"        id="path4227"        style="fill:url(#linearGradient3391);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 494.28615,54.3639 3.9188,0 0,-26.85467 -3.9188,0 0,-1.997457 29.17326,0 0,20.81792 -18.64395,0 0,8.034207 3.91879,0 0,1.997454 -14.4481,0 0,-1.997454 z m 27.39199,-26.85467 -16.86268,0 0,16.823007 16.86268,0 0,-16.823007 z" />     <path        inkscape:connector-curvature="0"        id="path4229"        style="fill:url(#linearGradient3389);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 552.68831,44.332237 3.91882,0 0,1.997456 -28.61909,0 0,-11.407687 18.08978,0 0,-7.412776 -16.30851,0 0,3.417866 -1.78127,0 0,-5.415323 24.70027,0 0,18.820464 z m -6.61049,0 0,-7.412776 -16.30851,0 0,7.412776 16.30851,0 z" />     <path        inkscape:connector-curvature="0"        id="path4231"        style="fill:url(#linearGradient3387);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 577.98669,25.511773 0,-8.034207 -3.91879,0 0,-1.997453 10.52928,0 0,28.852124 3.91879,0 0,1.997456 -29.17325,0 0,-20.81792 18.64397,0 z m -16.86269,18.820464 16.86269,0 0,-16.823007 -16.86269,0 0,16.823007 z" />     <path        inkscape:connector-curvature="0"        id="path4233"        style="fill:url(#linearGradient3385);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 599.21968,46.329693 -7.60009,0 0,-6.791347 7.60009,0 0,6.791347 z" />     <path        inkscape:connector-curvature="0"        id="path4235"        style="fill:url(#linearGradient3383);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 601.71129,54.3639 3.91879,0 0,-26.85467 -3.91879,0 0,-1.997457 29.17325,0 0,20.81792 -18.64396,0 0,8.034207 3.91878,0 0,1.997454 -14.44807,0 0,-1.997454 z m 27.39197,-26.85467 -16.86268,0 0,16.823007 16.86268,0 0,-16.823007 z" />     <path        inkscape:connector-curvature="0"        id="path4237"        style="fill:url(#linearGradient3381);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 659.83544,25.511773 0,5.370936 -1.78128,0 0,-3.373479 -12.86473,0 0,16.823007 3.91879,0 0,1.997456 -14.44807,0 0,-1.997456 3.91879,0 0,-16.823007 -3.91879,0 0,-1.997457 25.17529,0 z" />     <path        inkscape:connector-curvature="0"        id="path4239"        style="fill:url(#linearGradient3379);fill-opacity:1;stroke:#000000;stroke-width:0.62875605;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"        d="m 687.87312,46.329693 -24.70028,0 0,-20.81792 24.70028,0 0,20.81792 z m -1.78128,-18.820463 -16.3085,0 0,16.823007 16.3085,0 0,-16.823007 z" />   </g> </svg> '};window.NSSketchpad=X,c.prototype=Object.create(e.prototype),Object.assign(c.prototype,{normalize:function(t,e,i){return t<e&&(t=e),t>i&&(t=i),t},setPalettePointer:function(t,e){this.x=t,this.y=e,this.palettePointerEl.style.left=.03*-this.width+t+"px",this.palettePointerEl.style.top=.03*-this.height+.1*this.height+e+"px"},pickPalette:function(t,e){console.log("pickPalette",t,e),t=this.normalize(t,0,this.width),e=this.normalize(e,0,this.height);var i=this.paletteContext2d.getImageData(t,e,1,1).data;this.setPalettePointer(t,e);var s={r:i[0],g:i[1],b:i[2],a:i[3]/255};this.setColor(s)},setThresholdSlider:function(t){this.thresholdSliderEl.style.left=this.width*t-.015*this.width+"px"},setThreshold:function(t){t=Math.round(100*t)/100,this.threshold=t,this.setThresholdSlider(t)},changeThreshold:function(t){t=this.normalize(t,0,1),this.threshold=t,this.setThreshold(t)},focus:function(){this.isFocused=!0},blur:function(){this.isFocused=!1},getColor:function(){return{red:parseInt(this.color.red,10),green:parseInt(this.color.green,10),blue:parseInt(this.color.blue,10),alpha:parseFloat(this.color.alpha)}},putPixel:function(t,e,i,s){var o=4*(e+i*t.width);t.data[o]=s.r,t.data[o+1]=s.g,t.data[o+2]=s.b,t.data[o+3]=s.a},triggerUpdate:function(){var t=this.getColor();this.dispatch("change",{color:t})},updateFromInputs:function(){this.setColor({r:this.redInput.value,g:this.greenInput.value,b:this.blueInput.value,a:this.alphaInput.value}),this.setAlpha(this.alphaInput.value)},setColor:function(t,e){this.color.red=t.r,this.color.green=t.g,this.color.blue=t.b,this.color.alpha=t.a,this.redInput.value=t.r,this.greenInput.value=t.g,this.blueInput.value=t.b,this.alphaInput.value=t.a;var i=this.getColor();this.colorEl.style.backgroundColor="rgba("+i.red+","+i.green+","+i.blue+","+i.alpha+")",e||this.triggerUpdate()}}),window.Pixelpicker=c,Array.prototype.findIndex||(Array.prototype.findIndex=function(t){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,i=Object(this),s=i.length>>>0,o=arguments[1],r=0;r<s;r++)if(e=i[r],t.call(o,e,r,i))return r;return-1}),function(){var t,e,i,s,o=0,r=["ms","moz","webkit","o"];for(t=0,e=r.length;t<e&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[r[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[t]+"CancelAnimationFrame"]||window[r[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){return i=(new Date).getTime(),s=Math.max(0,16-(i-o)),o=i+s,window.setTimeout(function(){t(i+s)},s)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),"function"!=typeof Object.assign&&function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var s=arguments[i];if(void 0!==s&&null!==s)for(var o in s)s.hasOwnProperty(o)&&(e[o]=s[o])}return e}}(),Array.prototype.find||(Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,i=Object(this),s=i.length>>>0,o=arguments[1],r=0;r<s;r++)if(e=i[r],t.call(o,e,r,i))return e}),d.prototype=Object.create(e.prototype),Object.assign(d.prototype,{prepareLoadingElements:function(){this.id=parseInt(1e3*Math.random(),10),this.loadingBarEl=document.createElement("div");var t=Object.assign({position:"absolute",top:0,left:0,zIndex:200,height:"2px",width:"2px",backgroundColor:"rgba(0, 0, 155, 0.5)",transition:"width 0.4s ease-in-out",webkitTransition:"width 0.4s ease-in-out",MozTransition:"width 0.5s ease-in-out",msTransition:"width 0.5s ease-in-out",OTransition:"width 0.5s ease-in-out"},this.config.style);Object.assign(this.loadingBarEl.style,t),this.config.progressParentEl||(this.config.progressParentEl=window.document.body),this.config.progressParentEl.appendChild(this.loadingBarEl)},uploadProgress:function(t){this.dispatch("progress",t.loaded/t.total),this.loadingBarEl.style.width=parseInt(t.loaded/t.total*100,10)+"%"},uploadCompleteDestructor:function(){this.config.progressParentEl.removeChild(this.loadingBarEl)},uploadComplete:function(){if(this.completed)return void console.log("%cDOUBLED COMPLETE","background-color:orange",this.id);this.completed=!0,this.uploadProgress({loaded:1,total:1}),clearInterval(this.fakeProgressTo),setTimeout(this.uploadCompleteDestructor.bind(this),500)},startFakeProgress:function(){var t=this;t.fakeProgress=0,t.fakeTotal=100,this.fakeProgressTo=setInterval(function(){t.fakeProgress+=.01*(t.fakeTotal-t.fakeProgress),t.uploadProgress({loaded:t.fakeProgress,total:t.fakeTotal})},100)},cancel:function(t){if(this.completed)return void console.log("%DOUBLED CANCEL","background-color:orange",this.id);console.log("%cCANCEL","background-color:orange",this.id,t),clearInterval(this.fakeProgressTo),this.config.progressParentEl.removeChild(this.loadingBarEl),this.completed=!0},uploadCanceled:function(t){this.cancel(t)},uploadFailed:function(t){this.cancel(t)}}),window.Progressbar=d,Object.assign(p.prototype,{getImage:function(t,e,i){function s(t){e(a),l.sketchpad.planRefreshWindow(0,"resources.js:getImage:onImageLoadedOnce")}function o(t){a.loaded=!0,a.success=!0,console.log("on image loaded"),a.loadEvent=t,a.progressbar.uploadComplete(),s(t)}function r(t){if(a.loaded=!0,a.success=!1,a.loadEvent=t,a.progressbar.cancel(),"function"==typeof i)return i(a)}var a,n,l=this;for(n=0;n<this.images.length;n+=1)if(a=this.images[n],a.url===t){if(a.loaded){if(a.success)e(a);else if("function"==typeof i)return i(a)}else a.img.addEventListener("load",s);return}var h=new Image;h.crossOrigin="anonymous";var c=new d({progressParentEl:this.sketchpad.progressParentEl});c.startFakeProgress(),a={url:t,loaded:!1,progressbar:c,img:h},h.src=t,h.addEventListener("load",o),h.addEventListener("error",r),this.images.push(a)}}),window.Resources=p,u.prototype={instance:0,getConfig:function(){return{lay:this.layers.slice(),siz:this.size,col:this.color,fcl:this.fillColor,txt:this.textContent,fnt:this.font,axs:this.axis,tst:1,url:this.url,cen:this.center,mrh:this.mirrorH,mrv:this.mirrorV,mvh:this.mirrorVH,rbw:this.rainbow}},addPoint:function(t,e,i,s){this.sketchpad.readOnly||(e!==this.lastX||i!==this.lastY||s)&&(this.lastT=t-this.timestamp,this.lastX=e,this.lastY=i,this.listT.push(t-this.timestamp),this.listX.push(e),this.listY.push(i))},getLastPoint:function(){return!!this.listX.length&&{x:this.listX[this.listX.length-1],y:this.listY[this.listY.length-1]}},getPointsToSend:function(){var t;if(this.lastSendPointer<this.listX.length-1){var e=this.listT[this.lastSendPointer],i=this.listT.slice(this.lastSendPointer),s=this.listX.slice(this.lastSendPointer),o=this.listY.slice(this.lastSendPointer);for(this.lastSendPointer=this.listX.length-1,t=0;t<i.length;t+=1)i[t]-=e;return{t:i,x:s,y:o}}},getPointsToDraw:function(){if(this.lastDrawPointer<this.listX.length-1){var t=this.listX.slice(this.lastDrawPointer),e=this.listY.slice(this.lastDrawPointer),i=this.listT.slice(this.lastDrawPointer);this.lastDrawPointer=this.listX.length-1;return{t:i,x:t,y:e}}}},window.calculateOffsetXY=g,y.prototype=Object.create(e.prototype),Object.assign(y.prototype,{addSketchPage:function(t,e){function i(o){t.sid===o.getId()&&(s.removeListener("sketch-added",i),"function"==typeof e&&e(o,t))}var s=this;t=Object.assign({sid:"asp"+Math.random()+"h"+(t&&t.backgroundPdf&&t.backgroundPdf.fingerprint)},t),this.sendMessageToServer({cmd:"page",config:t},!1,function(){var e=s.room.addSketch(s,t,"no_autoselect");s.room.setActiveSketch(s,e)}),this.on("sketch-added",i)},getToolsConfigs:function(){var t,e={},i=this;return Object.keys(this.tools).forEach(function(s){var o=i.tools[s];t=o.getToolConfig(),e[t.toolId]=t}),e},setToolsConfigs:function(t){var e=this;Object.keys(this.tools).forEach(function(i){var s=e.tools[i],o=t[i];s&&o&&s.setToolConfig(o)})},setMetaConfig:function(t,e){return console.log("%cSET META CONFIG","background:green",t,e),!this.setMetaConfigFreeze&&(e&&(this.setMetaConfigFreeze=e),t=t||{},this.config=Object.assign(this.config,t),this.token=t.token||"#public",t.password&&(this.password=t.password||""),t.toolsConfigs&&this.setToolsConfigs(t.toolsConfigs),this.syncNetworkDataFrequency=t.syncNetworkDataFrequency||Math.round(1e3),this.centerViewport=!0,this.config.defaultTool&&this.getTool(this.config.defaultTool)&&this.setTool(this.config.defaultTool),this.displayGrid=this.config.features.displayGrid||!1,this.config.features.displayCrosshair?this.crosshairEl.style.display="block":this.crosshairEl.style.display="none",this.config.features.displayViewports?this.hudsEl.style.display="block":this.hudsEl.style.display="none",this.dispatch("setMetaConfig",t,this.setMetaConfigFreeze),this)},setSketchConfig:function(t){t.viewportX=parseFloat(t.viewportX)||0,t.viewportY=parseFloat(t.viewportY)||0,this.setViewportPosition(t.viewportX,t.viewportY),t.viewportScale=parseFloat(t.viewportScale)||1,this.setScale(t.viewportScale),t.viewportZRotation=parseFloat(t.viewportZRotation)||0,this.setRotation(t.viewportZRotation);var e=this;return t.backgroundColor?(this.backgroundColor=t.backgroundColor,this.containerEl.style.backgroundColor=t.backgroundColor):(this.backgroundColor=!1,this.containerEl.style.backgroundColor="transparent"),t.width||(t.width=1024),t.height||(t.height=768),t.backgroundUrl?(this.backgroundUrl=t.backgroundUrl,this.backgroundIFrame.style.display="block",this.backgroundIFrame.width=t.width,this.backgroundIFrame.style.width=t.width+"px",this.backgroundIFrame.height=t.height,this.backgroundIFrame.style.height=t.height+"px",this.backgroundIFrame.src=t.backgroundUrl,this.backgroundIFrame.crossOrigin="anonymous"):(this.backgroundIFrame.src="about:blank",this.backgroundUrl=!1,this.backgroundIFrame.style.display="none"),t.backgroundImage?(this.backgroundImage=t.backgroundImage,this.background.style.display="none",this.background.onload=function(){e.background.style.display="block",console.log("ON LOAD!"),e.planRefreshWindow(0,"sketchpad.js:setSketchConfig:background.onload"),e.backgroundImageProgressbar.uploadComplete()},this.background.onerror=function(){e.backgroundImageProgressbar.cancel()},this.backgroundImageProgressbar&&!this.backgroundImageProgressbar.completed&&this.backgroundImageProgressbar.cancel(),this.background.onerror=function(){e.backgroundImageProgressbar.cancel()},this.backgroundImageProgressbar=new d({progressParentEl:this.progressParentEl}),this.backgroundImageProgressbar.startFakeProgress(),this.background.src=t.backgroundImage.toString(),this.background.crossOrigin="anonymous"):(this.background.src="",this.backgroundImage=!1,this.background.style.display="none"),t.foregroundImage?(this.foregroundImage=t.foregroundImage,this.foreground.style.display="none",this.foreground.onload=function(){e.foreground.style.display="block",e.planRefreshWindow(0,"sketchpad.js:setSketchConfig:foreground.onload"),e.foregroundImageProgressbar.uploadComplete()},this.foreground.onerror=function(){e.foregroundImageProgressbar.cancel()},this.foregroundImageProgressbar&&!this.foregroundImageProgressbar.completed&&this.foregroundImageProgressbar.cancel(),this.foregroundImageProgressbar=new d({progressParentEl:this.progressParentEl}),this.foregroundImageProgressbar.startFakeProgress(),this.foreground.src=t.foregroundImage.toString(),this.foreground.crossOrigin="anonymous"):(this.foreground.src="",this.foregroundImage=!1,this.foreground.style.display="none"),this.planRefreshWindow(0,"sketchpad.js:setSketchConfig"),this.dispatch("setPageConfig",t),this},getRoomConfig:function(){var t={};return t.token=this.token,t.password=this.password,t.currentSketchSid=this.room.sketch&&this.room.sketch.getId()||"getRoomConfig-empty-sketch",t.toolsConfigs=this.getToolsConfigs(),t.defaultTool=this.tool,t.toolbar=this.config.toolbar,t.features=this.config.features,t},getSketchConfig:function(){var t={};return t.viewportX=parseFloat(this.viewportX)||0,t.viewportY=parseFloat(this.viewportY)||0,t.viewportScale=parseFloat(this.scale)||1,t.viewportZRotation=parseFloat(this.rotation)||0,this.config.backgroundType&&(t.backgroundType=this.config.backgroundType),this.config.backgroundColorR&&(t.backgroundColorR=this.config.backgroundColorR),this.config.backgroundColorG&&(t.backgroundColorG=this.config.backgroundColorG),this.config.backgroundColorB&&(t.backgroundColorB=this.config.backgroundColorB),this.config.backgroundColorR&&(t.backgroundColorA=this.config.backgroundColorA),this.config.backgroundMapsLocation&&(t.backgroundMapsLocation=this.config.backgroundMapsLocation),this.config.backgroundPdf&&(t.backgroundPdf=this.config.backgroundPdf),this.config.backgroundMapsType&&(t.backgroundMapsType=this.config.backgroundMapsType),this.config.backgroundMapsZoom&&(t.backgroundMapsZoom=this.config.backgroundMapsZoom),this.backgroundColor&&(t.backgroundColor=this.backgroundColor),this.backgroundImage&&(t.backgroundImage=this.backgroundImage),this.backgroundUrl&&(t.backgroundUrl=this.backgroundUrl),this.foregroundImage&&(t.foregroundImage=this.foregroundImage),t},saveSketchpad:function(t){var e=[],i=this.getRoomConfig();t||(i.password=""),e.push({hello:"Visit site www.sketchpad.pro to open this file.",site:"http://sketchpad.pro",description:"Sketchpad room file",cmd:"meta",config:i});var s;for(s=0;s<this.room.sketches.length;s+=1)e.push(this.room.sketches[s].getPageConfig(this)),e=e.concat(this.room.sketches[s].getFrames());return e},colorPicker:function(t,e){var i=document.createElement("canvas");i.width=1,i.height=1;var s=i.getContext("2d");this.backgroundColor&&(s.fillStyle=this.backgroundColor,s.fillRect(0,0,i.width,i.height)),s.translate(-this.width/2-t,-this.height/2-e),this.background&&this.background.width&&(s.save(),s.translate(this.width/2,this.height/2),s.rotate(this.rotation*Math.PI/180),s.scale(this.scale,this.scale),s.translate(-this.viewportX,-this.viewportY),s.drawImage(this.background,-this.background.width/2,-this.background.height/2),s.restore()),s.drawImage(this.canvasB,0,0),s.drawImage(this.canvas,0,0),this.foreground&&this.foreground.width&&(s.save(),s.translate(this.width/2,this.height/2),s.rotate(this.rotation*Math.PI/180),s.scale(this.scale,this.scale),s.translate(-this.viewportX,-this.viewportY),s.drawImage(this.foreground,-this.foreground.width/2,-this.foreground.height/2),s.restore()),this.watermark&&s.drawImage(this.watermark,this.width-this.watermark.width,this.height-this.watermark.height);var o=s.getImageData(0,0,1,1).data;return{r:o[0],g:o[1],b:o[2],a:o[3]/255}},renderOutputCanvas:function(t){var e=document.createElement("canvas"),i=this.viewportX,s=this.viewportY,o=this.width,r=this.height,a=this.rotation,n=this.scale;e.width=o,e.height=r;var l=e.getContext("2d");return t&&(this.backgroundColor&&"transparent"!==this.backgroundColor||(this.backgroundColor=t)),this.backgroundColor&&(l.fillStyle=this.backgroundColor,l.fillRect(0,0,e.width,e.height)),this.backgroundCanvas&&l.drawImage(this.backgroundCanvas,0,0),this.background&&this.background.width&&(l.save(),l.translate(o/2,r/2),l.rotate(a*Math.PI/180),l.scale(n,n),l.translate(-i,-s),l.drawImage(this.background,-this.background.width/2,-this.background.height/2),l.restore()),l.drawImage(this.canvasB,0,0),l.drawImage(this.canvas,0,0),this.foreground&&this.foreground.width&&(l.save(),l.translate(o/2,r/2),l.rotate(a*Math.PI/180),l.scale(n,n),l.translate(-i,-s),l.drawImage(this.foreground,-this.foreground.width/2,-this.foreground.height/2),l.restore()),this.watermark&&l.drawImage(this.watermark,o-this.watermark.width,r-this.watermark.height),e},screenshot:function(t,e,i){return this.renderOutputCanvas().toBlob(t,e,i)},toDataURL:function(t,e){var i=!1;return"image/jpeg"===e&&(i="white"),this.renderOutputCanvas(i).toDataURL(t,e)},showGrid:function(t){function e(t,e,i,s,r){o.beginPath(),o.strokeStyle=r,o.moveTo(t,e),o.lineTo(i,s),o.stroke()}function i(t,i){e(0,t,r.width,t,i)}function s(t,i){e(t,0,t,r.height,i)}var o=this.contextProjector2D;if(!o)return!1;var r=this;this.displayGrid=!0,t=t||{};var a=t.step||100,n=t.substep||10;o.save(),i(this.height/2,"rgba(0,0,0,0.1)"),s(this.width/2,"rgba(0,0,0,0.1)");var l,h;for(l=this.width/2;l<=this.width;l+=a)s(l,"rgba(255,0,0,0.2)");for(l=this.width/2;l>0;l-=a)s(l,"rgba(255,0,0,0.2)");for(l=this.width/2;l<=this.width;l+=n)s(l,"rgba(255,0,0,0.1)");for(l=this.width/2;l>0;l-=n)s(l,"rgba(255,0,0,0.1)");for(h=this.height/2;h<=this.height;h+=a)i(h,"rgba(255,0,0,0.2)");for(h=this.height/2;h>0;h-=a)i(h,"rgba(255,0,0,0.2)");for(h=this.height/2;h<=this.height;h+=n)i(h,"rgba(255,0,0,0.1)");for(h=this.height/2;h>0;h-=n)i(h,"rgba(255,0,0,0.1)");o.restore()},hideGrid:function(){this.displayGrid=!1,this.contextProjector2D.clearRect(0,0,this.width,this.height)},clearSketchpad:function(){this.windowWidth=this.containerEl.clientWidth,this.windowHeight=this.containerEl.clientHeight,this.backgroundCanvas.width=this.windowWidth,this.backgroundCanvas.height=this.windowHeight,this.canvas.width=this.windowWidth,this.canvas.height=this.windowHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.canvasB.width=this.windowWidth,this.canvasB.height=this.windowHeight,this.canvasProjector.width=this.windowWidth,this.canvasProjector.height=this.windowHeight,this.context2D=this.canvas.getContext("2d"),this.contextB2D=this.canvasB.getContext("2d"),this.contextProjector2D=this.canvasProjector.getContext("2d"),this.context2D.lineCap="round",this.context2D.lineJoin="round",this.contextB2D.lineCap="round",this.contextProjector2D.lineJoin="round",this.contextProjector2D.lineCap="round",
this.contextProjector2D.lineJoin="round",this.objectsCanva.innerHTML="",this.context2D.setTransform(1,0,0,1,0,0),this.contextB2D.clearRect(0,0,this.width,this.height),this.centerViewport&&(this.context2D.translate(this.width/2,this.height/2),this.contextB2D.translate(this.width/2,this.height/2));var t,e,i,s;this.displayGrid&&this.showGrid(),this.backgroundIFrame&&(this.centerViewport?(t=this.width/2-this.backgroundIFrame.width/2,e=this.height/2-this.backgroundIFrame.height/2,i=this.width/2,s=this.height/2,this.backgroundIFrame.style.transformOrigin=i+"px "+s+"px",this.backgroundIFrame.style.webkitTransformOrigin=i+"px "+s+"px",this.backgroundIFrame.style.MozTransformOrigin=i+"px "+s+"px",this.backgroundIFrame.style.msTransformOrigin=i+"px "+s+"px",this.backgroundIFrame.style.OTransformOrigin=i+"px "+s+"px",this.backgroundIFrame.style.transform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.backgroundIFrame.style.webkitTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.backgroundIFrame.style.MozTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.backgroundIFrame.style.msTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.backgroundIFrame.style.OTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)"):(this.backgroundIFrame.style.transform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.backgroundIFrame.style.webkitTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.backgroundIFrame.style.MozTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.backgroundIFrame.style.msTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.backgroundIFrame.style.OTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")")),this.background&&(this.centerViewport?(t=this.width/2-this.background.width/2,e=this.height/2-this.background.height/2,i=this.width/2,s=this.height/2,this.background.style.transformOrigin=i+"px "+s+"px",this.background.style.webkitTransformOrigin=i+"px "+s+"px",this.background.style.MozTransformOrigin=i+"px "+s+"px",this.background.style.msTransformOrigin=i+"px "+s+"px",this.background.style.OTransformOrigin=i+"px "+s+"px",this.background.style.transform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.background.style.webkitTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.background.style.MozTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.background.style.msTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.background.style.OTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)"):(this.background.style.transform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.background.style.webkitTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.background.style.MozTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.background.style.msTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.background.style.OTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")")),this.foreground&&(this.centerViewport?(t=this.width/2-this.foreground.width/2,e=this.height/2-this.foreground.height/2,i=this.width/2,s=this.height/2,this.foreground.style.transformOrigin=i+"px "+s+"px",this.foreground.style.webkitTransformOrigin=i+"px "+s+"px",this.foreground.style.MozTransformOrigin=i+"px "+s+"px",this.foreground.style.msTransformOrigin=i+"px "+s+"px",this.foreground.style.OTransformOrigin=i+"px "+s+"px",this.foreground.style.transform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.foreground.style.webkitTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.foreground.style.MozTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.foreground.style.msTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)",this.foreground.style.OTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px) translate("+t+"px, "+e+"px)"):(this.foreground.style.transform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.foreground.style.webkitTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.foreground.style.MozTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.foreground.style.msTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")",this.foreground.style.OTransform="translate("+1*-this.viewportX+"px, "+1*-this.viewportY+"px) scale("+1*this.scale+")")),this.hudsEl.style.transformOrigin=this.width/2+"px "+this.height/2+"px",this.hudsEl.style.webkitTransformOrigin=this.width/2+"px "+this.height/2+"px",this.hudsEl.style.MozTransformOrigin=this.width/2+"px "+this.height/2+"px",this.hudsEl.style.msTransformOrigin=this.width/2+"px "+this.height/2+"px",this.hudsEl.style.OTransformOrigin=this.width/2+"px "+this.height/2+"px",this.hudsEl.style.transform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px)",this.hudsEl.style.webkitTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px)",this.hudsEl.style.MozTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px)",this.hudsEl.style.msTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px)",this.hudsEl.style.OTransform="scale("+1*this.scale+") rotate("+1*this.rotation+"deg) translate("+-1*this.viewportX+"px, "+-1*this.viewportY+"px)"},refreshWindow:function(t){function e(t,a){if(s===i.postponeDrawingVersion&&o===i.room.sketch){var n;for(n=a;n<t.length&&n<a+r;n+=1)i.drawSketchFrame(t[n].evs,i.room.sketch);n<t.length&&setTimeout(function(){e(t,n)},0)}}if(this.initialised&&!this.receivingHistory){this.sendInputs(),this.drawInputs();var i=this,s=String(Date.now()),o=this.room.sketch;this.postponeDrawingVersion=s;var r=100;if(this.room&&this.room.sketch instanceof m){this.room.sketch.framesHistory.length>1024?(this.loadingEl.style.display="flex",this.loadingEl.textContent="..."):this.loadingEl.style.display="none",i.clearSketchpad();e(i.room.sketch.getCommandsHist(),0),i.loadingEl.style.display="none",i.dispatch("changeViewport"),i.dispatch("refreshWindow")}}},planRefreshWindow:function(t,e){t=parseInt(t)||0,this.planRefreshWindowTo&&clearTimeout(this.planRefreshWindowTo);var i=this;this.planRefreshWindowTo=setTimeout(function(){i.refreshWindow(e)},t)},setViewportPosition:function(t,e,i){t=parseFloat(t),e=parseFloat(e);var s={deltaX:t-this.viewportX,deltaY:e-this.viewportY};this.viewportX=t,this.viewportY=e;var o=this;return this.once("refreshWindow",function(){o.dispatch("setViewportPosition",s),i||o.sendCurrentViewport()},"setViewportPosition:sendCurrentViewport"),this.planRefreshWindow(0,"sketchpad.js:setViewportPosition"),this},moveViewportRelative:function(t,e){var i=-this.rotation,s={x:t*(1/this.scale),y:e*(1/this.scale)};return i=2*Math.PI*(i/360),s={x:Math.cos(i)*s.x-Math.sin(i)*s.y,y:Math.sin(i)*s.x+Math.cos(i)*s.y},this.setViewportPosition(this.viewportX-s.x,this.viewportY-s.y),this},setScale:function(t){return t=parseFloat(t),t||(t=1),this.scale=t,this.setViewportPosition(this.viewportX,this.viewportY),this},setRotation:function(t){return t%=360,t<0&&(t+=360),this.rotation=t,this.setViewportPosition(this.viewportX,this.viewportY),this.dispatch("setRotation",{o:t}),this},registerTool:function(t,e,i){function s(){this===r.getCurrentTool()&&r.user&&r.user.user_id&&r.projectPointer(r.pointerX,r.pointerY)}"object"!=typeof i&&(i={}),i.toolId=t,i.sketchpad=this;var o=new e(i);this.tools[o.toolId]=o;var r=this;o.on("changeParams",s),this.config&&this.config.registerToolCb&&"function"==typeof this.config.registerToolCb&&this.config.registerToolCb(o)},getCurrentTool:function(){return this.getTool(this.tool)},getCurrentToolId:function(){return this.tool},getTool:function(t){return t?this.tools[t]:this.getCurrentTool()},drawSketchNewFrames:function(){if(this.room.sketch instanceof m&&this.room){var t,e=this.room.sketch.getCommandsCurrent();for(t=0;t<e.length;t+=1)this.drawSketchFrame(e[t].evs,this.room.sketch)}},reset:function(t){if(this.room.reset(),!t){var e={cmd:"reset",ts:(new Date).getTime()};this.sendMessageToServer(e)}this.dispatch("reset"),this.planRefreshWindow(0,"sketchpad.js:reset")},canDraw:function(){return!this.readOnly},clearCanvas:function(){this.inputs={},this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height),this.contextB2D.clearRect(0,0,this.canvas.width,this.canvas.height)},setTool:function(t,e){if(this.getTool(t)){var i=this.tool!==t,s=this.tool;return this.tool=t,this.dispatch("setTool",{hasChanged:i,lastToolId:s,tool:this.getTool(t),extra:e}),this}},drawFramePath:function(t,e){if(this.drawingPaused)return void this.pausedQueue.push({config:t,points:e});if(e.x.length>0){var i=this.getTool(t.tol);i?i.drawFramePath(t,e):console.warn("sketchpad.js","Unknown tool",t)}},drawFrame:function(t){var e;for(e=0;e<t.length;e+=1)this.drawFramePath(t[e],t[e].pts)},pauseDrawing:function(){this.drawingPaused=!0},resumeDrawing:function(){var t;this.drawingPaused=!1;var e=this.pausedQueue;for(this.pausedQueue=[],t=0;t<e.length;t+=1)this.drawFramePath(e[t].config,e[t].points)},drawInputs:function(){var t,e,i,s=[],o=this;Object.keys(this.inputs).forEach(function(r){(t=o.inputs[r])&&(e=t.getPointsToDraw())&&(i={},i.tol=t.tool,i.cnf=t.getConfig(),i.vpx=t.viewportX,i.vpy=t.viewportY,i.scl=t.scale,i.rot=t.rotation,i.wdh=t.width,i.hgt=t.height,i.pts=e,i.uid=t.UID,s.push(i))}),s.length>0&&this.drawFrame(s)},drawSketchFrame:function(t,e){var i,s;for(i=0;i<t.length;i+=1)void 0!==t[i].cid&&(s=e.getCachedFrame(t[i].cid)),this.drawFramePath(s,t[i].pts)},startPath:function(t,e,i,s){if(this.inputs[e])return!1;var o=this.getCurrentToolId(),r=this.getTool(o),a=r.startInput(e,i,s,t);this.inputs[e]=a,this.dispatch("startPath",a)},drawPath:function(t,e,i,s){if(!this.inputs[e])return!1;this.getTool(this.inputs[e].tool).moveInput(this.inputs[e],i,s,t)},endPath:function(t,e,i,s){if(!this.inputs[e])return!1;this.getTool(this.inputs[e].tool).finishInput(this.inputs[e],i,s,t),this.sendInputs(),this.drawInputs(),delete this.inputs[e]},syncCanvasFrame:function(){var t=this;this.windowWidth===this.containerEl.clientWidth&&this.windowHeight===this.containerEl.clientHeight||(this.windowWidth=this.containerEl.clientWidth,this.windowHeight=this.containerEl.clientHeight,this.once("refreshWindow",function(){t.sendCurrentViewport()},"syncCanvasFrame:sendCurrentViewport:(resize)"),this.planRefreshWindow(1e3,"room.js:syncCanvasFrame:(resize)")),this.receivingHistory&&(this.loadingEl.textContent=this.receivingHistoryInputsLoaded+"/"+this.receivingHistoryInputsTotal),window.requestAnimationFrame(function(){t.syncCanvasFrame()}),this.drawSketchNewFrames(),this.drawInputs()},mainPos:function(t,e){var i=g(this.containerEl,t,e);return this.centerViewport&&(i.x=i.x-this.width/2,i.y=i.y-this.height/2),i},projectPointer:function(t,e){var i=this.getTool(),s=i.getCursor(),o=this.pointerEl;this.pointerEl.style.display="block",s&&s.pointer&&(this.containerEl.style.cursor=s.pointer),this.containerEl.style.cursor=s.pointer,Object.assign(o.style,s),o.style.position="absolute",o.style.left=t+"px",o.style.top=e+"px"},pointerMove:function(t,e){this.pointerX=parseInt(t+this.width/2,10),this.pointerY=parseInt(e+this.height/2,10),this.projectPointer(this.pointerX,this.pointerY)},createEventsDraw:function(){var t=this.containerEl,e=this;t.addEventListener("mousedown",function(t){if(e.inputEventsDisabled)return!1;t.preventDefault(),e.mouseLB=!0;var i=e.mainPos(t.clientX,t.clientY);e.startPath(t,0,i.x,i.y)},!1),t.addEventListener("mousemove",function(t){if(e.inputEventsDisabled)return!1;var i=e.mainPos(t.clientX,t.clientY);e.pointerMove(i.x,i.y),t.preventDefault(),e.mouseLB&&e.drawPath(t,0,i.x,i.y)},!1),t.addEventListener("mouseup",function(t){if(e.inputEventsDisabled)return!1;t.preventDefault(),e.mouseLB=!1;var i=e.mainPos(t.clientX,t.clientY);e.endPath(t,0,i.x,i.y)},!1),t.addEventListener("mouseleave",function(t){if(e.inputEventsDisabled||!e.mouseLB)return!1;t.preventDefault(),e.mouseLB=!1;var i=e.mainPos(t.clientX,t.clientY);e.endPath(t,0,i.x,i.y)},!1),t.addEventListener("contextmenu",function(t){if(e.inputEventsDisabled||!e.mouseLB)return!1;e.mouseLB=!1;var i=e.mainPos(t.clientX,t.clientY);e.endPath(t,0,i.x,i.y)},!1),t.addEventListener("touchstart",function(t){if(e.inputEventsDisabled)return!1;t.preventDefault();var i,s;for(i=0;i<t.changedTouches.length;i+=1)s=e.mainPos(t.changedTouches[i].clientX,t.changedTouches[i].clientY),e.startPath(t,t.changedTouches[i].identifier+10,s.x,s.y)},!1),t.addEventListener("touchmove",function(t){if(e.inputEventsDisabled)return!1;t.preventDefault();var i,s;for(i=0;i<t.changedTouches.length;i+=1)s=e.mainPos(t.changedTouches[i].clientX,t.changedTouches[i].clientY),e.drawPath(t,t.changedTouches[i].identifier+10,s.x,s.y)},!1),t.addEventListener("touchend",function(t){if(e.inputEventsDisabled)return!1;t.preventDefault();var i,s;for(i=0;i<t.changedTouches.length;i+=1)s=e.mainPos(t.changedTouches[i].clientX,t.changedTouches[i].clientY),e.endPath(t,t.changedTouches[i].identifier+10,s.x,s.y)},!1)},disableInputEvents:function(){this.inputEventsDisabled=!0},enableInputEvents:function(){this.inputEventsDisabled=!1},openConnection:function(t,e){console.info("sketchpad.js","[info] openConnection",e)},getCurrentViewport:function(){return{sid:this.room.sketch&&this.room.sketch.getId()||"getCurrentViewport-init",x:this.viewportX,y:this.viewportY,width:this.width,height:this.height,scale:this.scale,rotation:this.rotation,away:this.away}},sendCurrentViewport:function(){if(this.room.sketch instanceof m){var t={cmd:"update-viewport",user:{user_id:this.user&&this.user.user_id||this.UID,color:this.COLOR,viewport:this.getCurrentViewport()}};this.sendMessageToServer(t),this.room.updateClient(t.user),this.dispatch("updateClient",t.user)}},undo:function(){this.room.sketch.undo(this)},redo:function(){this.room.sketch.redo(this)},sendStringToServer:function(t,e,i){if(1!==this.ws.readyState)return"function"==typeof i&&i("offline"),"ignore";try{this.ws.send(t),"function"==typeof e&&e()}catch(e){console.error("Error sending ws message",e,t),"function"==typeof i&&i(e)}},sendMessageToServer:function(t,e,i){var s=JSON.stringify(t);return this.sendStringToServer(s,e,i)},executeInputCommand:function(t){var e,i;switch(t.cmd){case"ping":this.sendMessageToServer({cmd:"pong",requestNo:t.no,requestTs:t.ts});break;case"goto":t.position&&(t.position.pageNo&&(e=this.room.getSketchByNo(t.position.pageNo))&&this.room.setActiveSketch(this,e),void 0!==t.position.x&&void 0!==t.position.y&&this.setViewportPosition(t.position.x,t.position.y),t.position.scale&&this.setScale(t.position.scale),t.position.rotation&&this.setRotation(t.position.rotation));break;case"room-status":this.editorsCount=t.editorsCount,this.viewersCount=t.viewersCount,this.dispatch("changeRoomStatus");break;case"set-permissions":t.permissions?(this.readOnly=!t.permissions.canDraw,this.dispatch("set-permissions",t.permissions)):console.error("Received not valid permissions in set-permission response");break;case"meta":t.config?this.setMetaConfig(t.config,"freeze"):console.error("Received not valid config in meta response");break;case"page":t.config?e=this.room.setPageConfig(this,t.config):console.error("Received not valid page config in page response");break;case"remove-page":t.sid&&(e=this.room.getSketchBySid(t.sid)),e instanceof m?this.room.removeSketch(this,e,"remoteRemove"):console.warn("cannot remove sketch by input sid","[",t.sid,"]");break;case"clear-page":t.sid&&(e=this.room.getSketchBySid(t.sid)),e instanceof m?(e.reset(this,e,"remoteClear"),this.dispatch("sketch-cleared",e),this.planRefreshWindow(0,"sketchpad.js:executeInputCommand:clear-page")):console.warn("cannot clear sketch by input sid","[",t.sid,"]");break;case"history-begin":this.receivingHistory=!0,this.loadingEl.style.display="flex",this.receivingHistoryInputsTotal=t.inputsCount||t.messagesCount||"?",this.receivingHistoryInputsLoaded=0,this.loadingEl.textContent=this.receivingHistoryInputsLoaded+"/"+this.receivingHistoryInputsTotal;break;case"netspeed-begin":this.room.sketch.grindingThreshold=1e3;break;case"inputs":t.sid&&(e=this.room.getSketchBySid(t.sid)),e instanceof m||(console.warn("cannot find sketch by input sid, creating new sketch","[",t.sid,"]"),e=this.room.addSketch(this,Object.assign(this.getSketchConfig(),{sid:t.sid}),"remoteSketch"),this.room.sketch||this.room.setActiveSketch(this,e)),this.receivingHistory&&(this.receivingHistoryInputsLoaded+=1),e!==this.room.sketch&&(i=this.receivingHistory,this.receivingHistory=!0),e.grindBulkFrame(this,t,this.receivingHistory),e!==this.room.sketch&&(this.receivingHistory=i);break;case"history-end":this.receivingHistory=!1,this.loadingEl.style.display="none",this.planRefreshWindow(0,"sketchpad.js:executeInputCommand:history-end");break;case"netspeed-end":this.room.sketch.grindingThreshold=1e3/60;break;case"init-begin":this.initialised=!1;break;case"init-end":this.initialised=!0,this.config.currentPageNo||(this.config.currentPageNo=1),e=this.room.getSketchByNo(this.config.currentPageNo),e||(this.config.currentPageNo=1,e=this.room.getSketchByNo(this.config.currentPageNo)),e&&this.room.setActiveSketch(this,e),this.dispatch("initialised");break;case"reset":this.reset("remote");break;case"user-hello":t.user&&t.user.user_id&&t.user.viewport?(t.user.user_id=String(t.user.user_id),this.room.addClient(t.user),this.dispatch("addClient",t.user)):console.error("dropping user-hello, wrong  ``user || user.user_id``");break;case"pointer-move":t.user_id?this.room.setViewportPointer(t.user_id,t.x,t.y):console.error("dropping pointer-move, wrong ``user_id``");break;case"update-viewport":t.user&&t.user.user_id&&t.user.viewport?(t.user.user_id=String(t.user.user_id),this.room.updateClient(t.user),this.dispatch("updateClient",t.user)):console.error("dropping user-viewport, wrong  ``user || user.user_id``");break;case"user-bye":t.user&&t.user.user_id?(t.user.user_id=String(t.user.user_id),this.room.removeClientById(t.user.user_id),this.dispatch("removeClient",t.user)):console.error("dropping user-bye, wrong  ``user || user.user_id``");break;case"undo":t&&t.uid&&t.sid&&(e=this.room.getSketchBySid(t.sid),e instanceof m?e.undoSketch(this,t.uid):console.error("sketch not exists",t.sid,t),e===this.room.sketch&&this.planRefreshWindow(0,"sketchpad.js:executeInputCommand:undo"));break;case"you":t&&t.user&&(this.user=t.user,this.dispatch("identify",t.user));break;default:this.dispatch("customMessageFromServer",t)}},receiveMessageFromServer:function(t){var e=JSON.parse(t.data),i=this;e&&setTimeout(function(){i.executeInputCommand(e)},0)},sendInputs:function(){if(this.room&&this.room.sketch){var t,e,i,s={cmd:"inputs",sid:this.room.sketch.getId(),ts:(new Date).getTime(),uid:this.UID,evs:[]},o=this;if(Object.keys(this.inputs).forEach(function(r){(e=o.inputs[r])&&666!==r&&(i=e.getPointsToSend())&&(t={},t.tol=e.tool,t.cnf=e.getConfig(),t.vpx=e.viewportX,t.vpy=e.viewportY,t.scl=e.scale,t.rot=e.rotation,t.wdh=e.width,t.hgt=e.height,t.pts=i,t.uid=e.UID,s.evs.push(t))}),s.evs.length>0){this.sendMessageToServer(s);this.room.sketch.grindBulkFrame(this,s,!0)}}},syncNetworkData:function(){this.syncNetworkDataTimeout&&clearTimeout(this.syncNetworkDataTimeout),this.syncNetworkDataTimeout=0;var t=this;this.syncNetworkDataTimeout=setTimeout(function(){t.syncNetworkData()},this.syncNetworkDataFrequency),this.sendInputs()}}),v.prototype={reset:function(){var t;for(t=this.sketches.length-1;t>=0;t-=1)this.sketches[t].destructor(),this.sketches.splice(t,1);this.sketch=void 0},getSketchBySid:function(t){var e;for(e=0;e<this.sketches.length;e+=1)if(this.sketches[e].getId()===t)return this.sketches[e];return!1},getSketchByNo:function(t){var e=parseInt(t,10)-1;return this.sketches[e]},getCurrentSketchNo:function(){return this.sketches.indexOf(this.sketch)+1},addSketch:function(t,e){if(t.sendInputs(),t.drawInputs(),this.totalCount+=1,!e)throw new Error("Room.addSketch - config param is required");e=Object.assign({titleNo:this.totalCount},e);var i=new m(e);return this.sketches.push(i),t.dispatch("sketch-added",i),i},setPageConfig:function(t,e){var i;return e.sid&&(i=this.getSketchBySid(e.sid)),i?(this.sketch===i&&this.sketch.setConfig(t.getSketchConfig()),i.setConfig(e),this.sketch===i&&t.setSketchConfig(i.getConfig()),t.dispatch("sketch-changed",i)):i=this.addSketch(t,e,"remoteFlag"),this.sketch||this.setActiveSketch(t,i),i},setActiveSketch:function(t,e){if(!(e instanceof m))return void console.error("sketchpad.room.js","setActiveSketch(sketchpad, sketch) - sketch instanceof Sketch is required");t.sendInputs(),t.drawInputs(),this.sketch&&(this.sketch.setConfig(t.getSketchConfig()),this.prevSketch.push(this.sketch)),this.sketch=e,t.setSketchConfig(e.getConfig()),t.dispatch("sketch-changed",e),t.dispatch("historySketch-status",e.getHistoryStatus()),t.planRefreshWindow(0,"room.js:setActiveSketch")},removeSketch:function(t,e,i){if(!i&&!t.canDraw())return void console.error("Insufficient permissions to perform `removeSketch` operation");if(!(e instanceof m))throw new Error("sketchpad.room.js:removeSketch(sketchpad, sketch, remoteRemoveFlag), sketch must be instanceof Sketch");t.sendInputs(),t.drawInputs();var s;for(s=this.prevSketch.length-1;s>=0;s-=1)this.prevSketch[s]===e&&this.prevSketch.splice(s,1);for(s=this.sketches.length-1;s>=0;s-=1)this.sketches[s]===e&&this.sketches.splice(s,1);this.sketch===e&&(this.prevSketch.length>0?(this.sketch=this.prevSketch.pop(),t.setSketchConfig(this.sketch.getConfig()),t.dispatch("sketch-changed",this.sketch)):this.sketches.length>0?(this.sketch=this.sketches[0],t.dispatch("sketch-changed",this.sketch),t.setSketchConfig(this.sketch.getConfig())):(this.sketch=null,t.setSketchConfig({}))),t.dispatch("sketch-removed",e),i||t.sendMessageToServer({cmd:"remove-page",sid:e.getId()}),t.planRefreshWindow(0,"room.js:removeSketch")},addClient:function(t){"use strct";var e=t.user_color||{r:Math.round(25+205*Math.random()),g:Math.round(25+205*Math.random()),b:Math.round(25+205*Math.random())},i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div");o.style.display="none",o.style.backgroundColor="rgba("+e.r+", "+e.g+", "+e.b+", 0.5)",o.style.position="absolute",o.style.borderRadius="50%",o.style.marginLeft="-5px",o.style.marginTop="-5px",o.style.width="10px",o.style.height="10px",s.className="username",s.textContent="New ID: "+t.user_id,s.style.backgroundColor="rgba("+e.r+", "+e.g+", "+e.b+", 1)",s.style.color="#FFF",s.style.fontSize="12px",i.appendChild(o),i.appendChild(s),i.className="viewport",i.style.position="absolute",i.style.overflow="hidden",i.style.border="1px solid rgba("+e.r+", "+e.g+", "+e.b+", 1)",i.style.boxSizing="border-box",t.pointerEl=o,t.viewportEl=i,this.setViewport(i,t,this.sketchpad),this.sketchpad.hudsEl.appendChild(t.viewportEl),this.clients.push(t),this.redrawViewports()},setViewportPointer:function(t,e,i){var s=this.getClientById(t);s&&(s.pointerEl.style.display="block",s.pointerEl.style.left=e+"px",s.pointerEl.style.top=i+"px")},setViewport:function(t,e,i){if(this.sketch instanceof m){var s=e.viewport;s.sid!==i.room.sketch.getId()?t.style.display="none":t.style.display="block",e.user_id===i.user.user_id&&(t.style.border="none",t.style.zIndex=2),t.querySelector(".username").textContent=(e.viewport.away?"[Away]":"")+" "+e.user_name,t.style.top="0px",t.style.left="0px",t.style.width=s.width+"px",t.style.height=s.height+"px",t.style.transformOrigin=s.x+"px "+s.y+"px",t.style.webkitTransformOrigin=s.x+"px "+s.y+"px",t.style.MozTransformOrigin=s.x+"px "+s.y+"px",t.style.msTransformOrigin=s.x+"px "+s.y+"px",t.style.OTransformOrigin=s.x+"px "+s.y+"px";var o="translate("+i.width/2+"px,"+i.height/2+"px) scale("+1/s.scale+") rotate("+-1*s.rotation+"deg) translate("+s.x+"px, "+s.y+"px) translate("+-s.width/2+"px, "+-s.height/2+"px)";t.style.transform=o,t.style.webkitTransform=o,t.style.MozTransform=o,t.style.msTransform=o,t.style.OTransform=o}},redrawViewports:function(){var t=this;this.clients.forEach(function(e){t.setViewport(e.viewportEl,e,t.sketchpad)})},updateClient:function(t){var e,i;for(e=0;e<this.clients.length;e+=1)i=this.clients[e],i.user_id===t.user_id&&(i.webrtc=t.webrtc,i.viewport=t.viewport);this.redrawViewports()},getClientById:function(t){var e,i;for(e=this.clients.length-1;e>=0;e-=1)if(i=this.clients[e],String(i.user_id)===String(t))return i},removeClientById:function(t){console.warn("Removing user",t);var e,i,s=this;for(e=this.clients.length-1;e>=0;e-=1)i=this.clients[e],String(i.user_id)===String(t)&&(s.sketchpad.hudsEl.removeChild(i.viewportEl),this.clients.splice(e,1))}},m.prototype=Object.create(e.prototype),Object.assign(m.prototype,{getHistoryStatus:function(){return{undo:this.userBFramesCounter,redo:this.myStash.length}},getId:function(){return String(this.config.sid)},setConfig:function(t){this.config=Object.assign(this.config,t)},getConfig:function(){return this.config},getPageConfig:function(t){return this===t.room.sketch&&this.setConfig(t.getSketchConfig()),{description:"Drawing board sketch page",version:"0.5.1",timestamp:Date.now(),timestampISO:(new Date).toISOString(),host:document.location.host,cmd:"page",config:this.getConfig()}},getFrames:function(){var t,e,i=this.framesHistory.concat(this.newFrames);for(t=0;t<i.length;t+=1)for(e=0;e<i[t].evs.length;e+=1)void 0!==i[t].evs[e].cid&&Object.assign(i[t].evs[e],this.getCachedFrame(i[t].evs[e].cid)),i[t].cmd="inputs",i[t].sid=this.getId();return i},cacheFrame:function(t){var e=this.toolsCache.findIndex(function(e){return!!e&&(e.tol===t.tol&&e.vpx===t.vpx&&e.vpy===t.vpy&&e.scl===t.scl&&e.rot===t.rot&&e.hgt===t.hgt&&e.wdh===t.wdh&&JSON.stringify(e.cnf)===JSON.stringify(t.cnf))});return-1===e?(this.toolsCache.push({vpx:t.vpx,vpy:t.vpy,scl:t.scl,rot:t.rot,tol:t.tol,hgt:t.hgt,wdh:t.wdh,cnf:t.cnf}),this.toolsCache.length-1):e},getCachedFrame:function(t){return this.toolsCache[t]},reset:function(){this.toolsCache=[],this.myStash=[],this.framesHistory=[],this.newFrames=[],this.grindingThreshold=1e3/60},grindBulkFrame:function(t,e,i){var s,o,r,a,n,l=this;if(this.bulkId+=1,t.UID===e.uid&&(this.userBFramesCounter||t.dispatch("undoAvaliable"),this.userBFramesCounter+=1),e.evs&&e.evs.length)for(;e.evs.length;){for(r=e.evs[0].pts.t[0],o=r+this.grindingThreshold,s={uid:e.uid,bid:this.bulkId,evs:[]},a=e.evs.length-1;a>=0;a-=1)e.evs[a].pts.t.length>1&&(n=function(t,e){for(var i,s=0;t.pts.t[s]<=e;)s+=1;s<2&&(s=2),i={cid:l.cacheFrame(t),pts:{t:t.pts.t.splice(0,s),x:t.pts.x.splice(0,s),y:t.pts.y.splice(0,s)}};var o=i.pts.t[i.pts.t.length-1],r=i.pts.x[i.pts.x.length-1],a=i.pts.y[i.pts.y.length-1];return t.pts.t.unshift(o),t.pts.x.unshift(r),t.pts.y.unshift(a),i}(e.evs[a],o),s.evs.push(n)),e.evs[a].pts.t.length<2&&e.evs.splice(a,1);i?this.framesHistory.push(s):this.newFrames.push(s)}},getCommandsHist:function(){return this.framesHistory},getCommandsCurrent:function(){var t,e=this.newFrames.splice(0,1);if(e.length){for(t=0;t<e.length;t+=1)this.framesHistory.push(e[t]);return e}return[]},undoSketch:function(t,e){function i(t,e,i){var r,a,n=t.length;for(n-=1;n>-1;n-=1)if(!i&&t[n].uid===e||t[n].uid===e&&t[n].bid===i){for(r=t.splice(n,1)[0],i=r.bid,a=0;a<r.evs.length;a+=1)void 0!==r.evs[a].cid&&Object.assign(r.evs[a],o.getCachedFrame(r.evs[a].cid));s.push(r)}}var s=[],o=this;return i(this.newFrames,e,!1),i(this.framesHistory,e,!1),t.UID===e&&s.length&&(this.userBFramesCounter-=1,0===this.userBFramesCounter&&t.dispatch("undoUnavaliable")),s},sendUndo:function(t){t.sendMessageToServer({sid:this.getId(),cmd:"undo",uid:t.UID,user:{user_id:t.UID}})},undo:function(t){t.sendInputs();var e=this.undoSketch(t,t.UID);this.sendUndo(t),t.planRefreshWindow(0,"undo"),this.myStash=this.myStash.concat(e),this.myStash.length>0&&t.dispatch("redoAvaliable")},redo:function(t){if(this.myStash&&this.myStash.length>0){if(!this.myStash.length)return void console.warn("Redo stash empty!");var e=this.myStash.splice(-1)[0],i={uid:t.UID,ts:(new Date).getTime(),cmd:"inputs",evs:e.evs};t.sendMessageToServer(i),this.grindBulkFrame(t,e),0===this.myStash.length&&t.dispatch("redoUnavaliable")}else t.dispatch("redoUnavaliable")},destructor:function(){this.reset()}}),w.prototype=Object.create(e.prototype),w.prototype=Object.assign(w.prototype,{sketchpad:"error: undefined sketchpad object",layers:["F"],toolLabel:"Default tool",toolId:"default_tool_class",lineWidth:1,minSize:.1,maxSize:100,maxLayers:1,color:{r:0,g:0,b:0,a:1},getCursor:function(){var t=parseInt(this.getSize()+1,10);return{pointer:"crosshair",marginLeft:-t/2+"px",marginTop:-t/2+"px",width:t+"px",height:t+"px",border:"1px solid black",boxSizing:"border-box",borderRadius:"50%",backgroundColor:"rgba(0,0,0,0)"}},getToolConfig:function(){return{toolId:this.toolId,layers:this.layers,lineWidth:this.lineWidth,maxLayers:this.maxLayers,color:this.getColorStr()}},setToolConfig:function(t){Array.isArray(t.layers)&&(this.layers=t.layers);var e,i;if(t.color)switch(typeof t.color){case"string":e=String(t.color).match(/([0-9]+),([0-9]+),([0-9]+),([0-9\.]+)/),i={r:parseInt(e&&e[1])||0,g:parseInt(e&&e[2])||0,b:parseInt(e&&e[3])||0,a:parseFloat(e&&e[4])||0},this.setColor(i.r,i.g,i.b,i.a);break;case"object":this.setColor(t.color.r,t.color.g,t.color.b,t.color.a)}return parseFloat(t.lineWidth)&&this.setSize(parseFloat(t.lineWidth)),this.dispatch("changeParams"),this},distance:function(t,e,i,s){return Math.sqrt(Math.pow(Math.abs(t-i),2)+Math.pow(Math.abs(e-s),2))},rotate:function(t,e){return t=2*Math.PI*(t/360),e={x:Math.cos(t)*e.x-Math.sin(t)*e.y,y:Math.sin(t)*e.x+Math.cos(t)*e.y}},setColor:function(t,e,i,s){return void 0===s&&(s=this.color.a),this.color={r:t,g:e,b:i,a:s},this.dispatch("changeParams"),this},getColor:function(){return this.color},getColorStr:function(){return"rgba("+this.color.r+","+this.color.g+","+this.color.b+","+this.color.a+")"},setSize:function(t){return this.lineWidth=parseFloat(t),this.dispatch("changeParams"),this},getSize:function(){return this.lineWidth},startInput:function(t,e,i,s){
s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=new u({sketchpad:o,id:t,tool:this.toolId,layers:this.layers,color:this.getColorStr(),size:this.lineWidth});return r.addPoint((new Date).getTime(),e,i),r.addPoint((new Date).getTime(),e,i,"force"),r},moveInput:function(t,e,i,s){if(s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10)),s&&s.shiftKey){var o=t.getLastPoint();if(o&&(Math.abs(o.x-e)<10&&(e=o.x),Math.abs(o.y-i)<10&&(i=o.y),o.x===e&&o.y===i))return!1}t.addPoint((new Date).getTime(),e,i,s)},finishInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10)),t.addPoint((new Date).getTime(),e,i)},drawFramePath:function(t,e){var i,s,o,r=this.sketchpad,a=t.cnf;if(!a.lay||!a.lay.length)return void console.warn("no layers to draw");for(o=0;o<a.lay.length;o+=1){switch(a.lay[o]){case r.LAYER_BACK:i=r.contextB2D;break;case r.LAYER_FRONT:i=r.context2D;break;default:i=r.context2D}if(i.save(),i.rotate(r.rotation*Math.PI/180),i.scale(r.scale,r.scale),i.translate(t.vpx,t.vpy),i.translate(-r.viewportX,-r.viewportY),i.scale(1/t.scl,1/t.scl),i.rotate(-t.rot*Math.PI/180),e&&e.x&&e.x.length>1){for(i.beginPath(),i.lineCap="round",i.lineJoin="round",i.strokeStyle=a.col,i.lineWidth=a.siz,i.moveTo(e.x[0],e.y[0]),s=1;s<e.x.length;s+=1)i.lineTo(e.x[s],e.y[s]);i.stroke()}i.restore()}}}),X.avaliableTools.push(w),k.prototype=Object.create(w.prototype),Object.assign(k.prototype,{toolLabel:"_fillable class",toolId:"_fillable class",fillColor:{r:128,g:0,b:128,a:.1},getToolConfig:function(){var t=w.prototype.getToolConfig.call(this);return Object.assign(t,{fillColor:this.getFillColorStr()})},setToolConfig:function(t){w.prototype.setToolConfig.call(this,t);var e,i;if(t.fillColor)switch(typeof t.fillColor){case"string":e=String(t.fillColor).match(/([0-9]+),([0-9]+),([0-9]+),([0-9\.]+)/),i={r:parseInt(e&&e[1])||0,g:parseInt(e&&e[2])||0,b:parseInt(e&&e[3])||0,a:parseFloat(e&&e[4])||0},this.setFillColor(i.r,i.g,i.b,i.a);break;case"object":this.setFillColor(t.fillColor.r,t.fillColor.g,t.fillColor.b,t.fillColor.a)}return this.dispatch("changeParams"),this},setFillColor:function(t,e,i,s){return void 0===s&&(s=this.fillColor.a),this.fillColor={r:t,g:e,b:i,a:s},this.dispatch("changeParams"),this},getFillColor:function(){return this.fillColor},getFillColorStr:function(){return"rgba("+this.fillColor.r+","+this.fillColor.g+","+this.fillColor.b+","+this.fillColor.a+")"}}),b.prototype=Object.create(k.prototype),Object.assign(b.prototype,{lineWidth:1,toolLabel:"Circle",layers:["F"],toolId:"circle",keyCode:67,color:{r:0,g:0,b:0,a:1},fillColor:{r:255,g:127,b:0,a:0},startInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=new u({sketchpad:o,id:t,tool:this.toolId,color:this.getColorStr(),fillColor:this.getFillColorStr(),size:this.lineWidth,layers:this.layers,uid:this.sketchpad.UID});return r.firstX=e,r.firstY=i,r.selectorDiv=document.createElement("div"),r.selectorDiv.style.position="absolute",r.selectorDiv.style.border="1px solid white",r.selectorDiv.style.borderRadius="50%",r.selectorDiv.style.display="block",this.sketchpad.centerViewport?(r.selectorDiv.style.left=this.sketchpad.width/2+e-1+"px",r.selectorDiv.style.top=this.sketchpad.height/2+i-1+"px"):(r.selectorDiv.style.left=e-1+"px",r.selectorDiv.style.top=i-1+"px"),r.selectorDiv.style.width="1px",r.selectorDiv.style.height="1px",r.selectorDiv2=document.createElement("div"),r.selectorDiv2.style.position="absolute",r.selectorDiv2.style.border="1px dashed black",r.selectorDiv2.style.borderRadius="50%",r.selectorDiv2.style.display="block",this.sketchpad.centerViewport?(r.selectorDiv2.style.left=this.sketchpad.width/2+e-1+"px",r.selectorDiv2.style.top=this.sketchpad.height/2+i-1+"px"):(r.selectorDiv2.style.left=e-1+"px",r.selectorDiv2.style.top=i-1+"px"),r.selectorDiv2.style.width="1px",r.selectorDiv2.style.height="1px",o.containerEl.appendChild(r.selectorDiv),o.containerEl.appendChild(r.selectorDiv2),r.addPoint((new Date).getTime(),e,i),r},moveInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=t.firstX,r=t.firstY,a=Math.abs(e-o),n=Math.abs(i-r);s.shiftKey&&(a=n),this.sketchpad.centerViewport?(t.selectorDiv.style.left=this.sketchpad.width/2+o-a+"px",t.selectorDiv.style.top=this.sketchpad.height/2+r-n+"px",t.selectorDiv2.style.left=this.sketchpad.width/2+o-a+"px",t.selectorDiv2.style.top=this.sketchpad.height/2+r-n+"px"):(t.selectorDiv.style.left=o-a+"px",t.selectorDiv.style.top=r-n+"px",t.selectorDiv2.style.left=o-a+"px",t.selectorDiv2.style.top=r-n+"px"),t.selectorDiv.style.width=2*a+"px",t.selectorDiv.style.height=2*n+"px",t.selectorDiv2.style.width=2*a+"px",t.selectorDiv2.style.height=2*n+"px"},finishInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=t.firstX,a=t.firstY,n=Math.abs(i-a);s.shiftKey&&(e=r+n),t.addPoint((new Date).getTime(),e,i),o.containerEl.removeChild(t.selectorDiv),o.containerEl.removeChild(t.selectorDiv2)},recalcS:function(t,e){var i=this.sketchpad;return e*=1/t.scl,e*=i.scale},drawFramePath:function(t,e){var i,s,o,r=t.cnf,a=this.sketchpad;if(!r.lay||!r.lay.length)return void console.warn("no layers to draw");var n,l;for(i=0;i<r.lay.length;i+=1){switch(r.lay[i]){case a.LAYER_BACK:o=a.contextB2D;break;case a.LAYER_FRONT:o=a.context2D;break;default:o=a.context2D}o.save(),o.rotate(a.rotation*Math.PI/180),o.scale(a.scale,a.scale),o.translate(t.vpx,t.vpy),o.translate(-a.viewportX,-a.viewportY),o.scale(1/t.scl,1/t.scl),o.rotate(-t.rot*Math.PI/180),n={x:e.x[0],y:e.y[0]},l={x:e.x[1],y:e.y[1]},o.translate(n.x,n.y),o.beginPath(),o.scale(1,Math.abs(l.y-n.y)/Math.abs(l.x-n.x)),s=Math.abs(l.x-n.x),o.arc(0,0,s,0,2*Math.PI,!1),o.restore(),o.strokeStyle=r.col,o.fillStyle=r.fcl,o.lineWidth=this.recalcS(t,r.siz),o.fill(),o.stroke(),o.restore()}}}),X.avaliableTools.push(b),x.prototype=Object.create(k.prototype),Object.assign(x.prototype,{maxLayers:0,keyCode:73,toolLabel:"Colorpicker",toolId:"colorpicker",color:{r:128,g:128,b:128,a:0},getCursor:function(){return{pointer:"none",marginLeft:"-5px",marginTop:"-5px",width:"10px",height:"10px",borderRadius:"50%",border:"1px solid black",backgroundColor:this.getColorStr()}},startInput:function(t,e,i,s){var o=this.sketchpad,r=new u({sketchpad:o,id:t,tool:this.toolId}),a=this.sketchpad.colorPicker(e,i);return s.shiftKey||2===s.button?(this.fillColorChanged=!0,this.setFillColor(a.r,a.g,a.b,a.a)):(this.colorChanged=!0,this.setColor(a.r,a.g,a.b,a.a)),r.tmpCursor=this.sketchpad.containerEl.style.cursor,o.containerEl.style.cursor="crosshair",r},moveInput:function(t,e,i,s){var o=this.sketchpad.colorPicker(e,i);return 2===s.button&&(s.preventDefault(),s.stopPropagation()),s.shiftKey||2===s.button?(this.fillColorChanged=!0,this.setFillColor(o.r,o.g,o.b,o.a)):(this.colorChanged=!0,this.setColor(o.r,o.g,o.b,o.a)),t},finishInput:function(t,e,i,s){var o=this.sketchpad.colorPicker(e,i);return 2===s.button&&(s.preventDefault(),s.stopPropagation()),s.shiftKey||2===s.button?(this.fillColorChanged=!0,this.setFillColor(o.r,o.g,o.b,o.a)):(this.colorChanged=!0,this.setColor(o.r,o.g,o.b,o.a)),this.sketchpad.containerEl.style.cursor=t.tmpCursor,t},drawFramePath:function(){}}),X.avaliableTools.push(x),C.prototype=Object.create(w.prototype),Object.assign(C.prototype,{toolId:"custom",lineWidth:10,keyCode:88,toolLabel:"Custom tool",drawFramePath:function(t,e){var i,s,o,r=t.cnf,a=this.sketchpad;if(o=null,!r.lay||!r.lay.length)return void console.warn("no layers to draw");var n,l;for(s=0;s<r.lay.length;s+=1){switch(r.lay[s]){case a.LAYER_BACK:o=a.contextB2D;break;case a.LAYER_FRONT:o=a.context2D;break;default:o=a.context2D}if(o.save(),o.rotate(a.rotation*Math.PI/180),o.scale(a.scale,a.scale),o.translate(t.vpx,t.vpy),o.translate(-a.viewportX,-a.viewportY),o.scale(1/t.scl,1/t.scl),o.rotate(-t.rot*Math.PI/180),e&&e.x&&e.y&&e.x.length>1)for(i=1;i<e.x.length;i+=1)n={x:e.x[i-1],y:e.y[i-1]},l={x:e.x[i],y:e.y[i]},o.beginPath(),o.strokeStyle=this.getColorStr(),o.lineCap="miter",o.lineJoin="miter",o.lineWidth=r.siz+100/(10+this.distance(n.x,n.y,l.x,l.y)),o.moveTo(n.x,n.y),o.lineTo(l.x,l.y),o.stroke();o.restore()}}}),X.avaliableTools.push(C),E.prototype=Object.create(w.prototype),Object.assign(E.prototype,{maxLayers:"*",toolId:"cutout",layers:["F","B"],toolLabel:"Cut-out",getCursor:function(){return{pointer:"crosshair",borderRadius:0,backgroundColor:"rgba(0,0,0,0)",border:"none"}},startInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=new u({sketchpad:o,id:t,tool:this.toolId,layers:this.layers});return r.selectorDiv=document.createElement("div"),r.selectorDiv.style.position="absolute",r.selectorDiv.style.border="1px solid #f00",r.selectorDiv.style.display="block",this.sketchpad.centerViewport?(r.selectorDiv.style.left=this.sketchpad.width/2+e+"px",r.selectorDiv.style.top=this.sketchpad.height/2+i+"px"):(r.selectorDiv.style.left=e+"px",r.selectorDiv.style.top=i+"px"),r.selectorDiv.style.width="1px",r.selectorDiv.style.height="1px",r.selectorDiv.style.background="#f88",r.selectorDiv.style.opacity="0.3",o.containerEl.appendChild(r.selectorDiv),r.addPoint((new Date).getTime(),e,i),r},moveInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=t.listX[0],r=t.listY[0],a=Math.min(o,e),n=Math.min(r,i),l=Math.max(o,e),h=Math.max(r,i);this.sketchpad.centerViewport?(t.selectorDiv.style.left=this.sketchpad.width/2+a+"px",t.selectorDiv.style.top=this.sketchpad.height/2+n+"px"):(t.selectorDiv.style.left=a+"px",t.selectorDiv.style.top=n+"px"),t.selectorDiv.style.width=l-a+"px",t.selectorDiv.style.height=h-n+"px"},finishInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad;t.addPoint((new Date).getTime(),e,i),o.containerEl.removeChild(t.selectorDiv)},drawFramePath:function(t,e){var i,s=t.cnf,o=this.sketchpad;if(!s.lay||!s.lay.length)return void console.warn("no layers to draw");var r;for(i=0;i<s.lay.length;i+=1){switch(s.lay[i]){case o.LAYER_BACK:r=o.contextB2D;break;case o.LAYER_FRONT:r=o.context2D}r.save(),r.rotate(o.rotation*Math.PI/180),r.scale(o.scale,o.scale),r.translate(t.vpx,t.vpy),r.translate(-o.viewportX,-o.viewportY),r.scale(1/t.scl,1/t.scl),r.rotate(-t.rot*Math.PI/180),r.clearRect(e.x[0],e.y[0],e.x[1]-e.x[0],e.y[1]-e.y[0]),r.restore()}}}),X.avaliableTools.push(E),I.prototype=Object.create(w.prototype),Object.assign(I.prototype,{toolId:"eraser",maxLayers:"*",layers:["F","B"],lineWidth:16,minSize:2,maxSize:200,toolLabel:"Eraser",getCursor:function(){var t=parseInt(this.getSize()+1,10);return{pointer:"crosshair",marginLeft:-t/2+"px",marginTop:-t/2+"px",width:t+"px",height:t+"px",border:"1px solid black",boxSizing:"border-box",borderRadius:"50%",backgroundColor:"rgba(255,255,255,.5)"}},drawFramePath:function(t,e){var i,s,o,r=t.cnf,a=this.sketchpad;if(o=null,!r.lay||!r.lay.length)return void console.warn("no layers to draw");var n,l;for(s=0;s<r.lay.length;s+=1){switch(r.lay[s]){case a.LAYER_BACK:o=a.contextB2D;break;case a.LAYER_FRONT:o=a.context2D}if(o.save(),o.globalCompositeOperation="destination-out",o.rotate(a.rotation*Math.PI/180),o.scale(a.scale,a.scale),o.translate(t.vpx,t.vpy),o.translate(-a.viewportX,-a.viewportY),o.scale(1/t.scl,1/t.scl),o.rotate(-t.rot*Math.PI/180),e&&e.x&&e.y&&e.x.length>1)for(i=1;i<e.x.length;i+=1)n={x:e.x[i-1],y:e.y[i-1]},l={x:e.x[i],y:e.y[i]},o.beginPath(),o.strokeStyle=this.getColorStr(n.x,n.y),o.lineCap="miter",o.lineJoin="miter",o.lineWidth=r.siz,o.moveTo(n.x,n.y),o.lineTo(l.x,l.y),o.stroke();o.restore()}}}),X.avaliableTools.push(I),A.prototype=Object.create(w.prototype),Object.assign(A.prototype,{toolId:"highlighter",color:{r:255,g:255,b:15,a:.5},layers:["B"],lineWidth:16,keyCode:72,toolLabel:"Highlighter",getCursor:function(){var t=parseInt(this.getSize(),10);return t=t/2+t/(t/5+0),{pointer:"none",marginLeft:-t/2+"px",marginTop:-t/2+"px",width:t+"px",height:t+"px",border:"none",borderRadius:0,backgroundColor:this.getColorStr()}},drawFramePath:function(t,e){var i,s,o,r,a,n=this.sketchpad,l=t.cnf;if(!l.lay||!l.lay.length)return void console.warn("no layers to draw");for(o=0;o<l.lay.length;o+=1){switch(l.lay[o]){case n.LAYER_BACK:i=n.contextB2D;break;case n.LAYER_FRONT:i=n.context2D;break;default:i=n.context2D}if(i.save(),i.lineCap="butt",i.lineJoin="round",i.rotate(n.rotation*Math.PI/180),i.scale(n.scale,n.scale),i.translate(t.vpx,t.vpy),i.translate(-n.viewportX,-n.viewportY),i.scale(1/t.scl,1/t.scl),i.rotate(-t.rot*Math.PI/180),i.strokeStyle=l.col,i.lineWidth=l.siz,e&&e.x&&e.x.length>1)for(s=1;s<e.x.length;s+=1)r={x:e.x[s-1],y:e.y[s-1]},a={x:e.x[s],y:e.y[s]},i.beginPath(),i.lineWidth=l.siz/2+l.siz/(l.siz/5+this.distance(r.x,r.y,a.x,a.y)/10),i.moveTo(r.x,r.y),i.lineTo(a.x,a.y),i.stroke();i.restore()}}}),X.avaliableTools.push(A),S.prototype=Object.create(w.prototype),Object.assign(S.prototype,{layers:["F"],toolLabel:"Image",toolId:"image",keyCode:79,disabled:!1,fieldThreshold:100,disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},getCursor:function(){return{pointer:"crosshair",backgroundColor:"rgba(0,0,0,0)",borderRadius:"0",border:"none"}},onImagehostError:function(t){popnotifications.notification(t.title,t.message)},onImagehostReady:function(t,e,i,s,o,r){var a=new u({sketchpad:this.sketchpad,id:777,tool:this.toolId,layers:this.layers,url:t,center:r});this.sketchpad.inputs[777]=a,a.addPoint((new Date).getTime(),e,i),a.addPoint((new Date).getTime(),s,o,"force"),this.sketchpad.sendInputs(),this.sketchpad.drawInputs(),delete this.sketchpad.inputs[777]},startInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=new u({sketchpad:o,id:t,tool:this.toolId,layers:this.layers});return r.firstX=e,r.firstY=i,r.selectorDiv=document.createElement("div"),r.selectorDiv.style.position="absolute",r.selectorDiv.style.border="1px solid black",r.selectorDiv.style.outline="1px dashed white",r.selectorDiv.style.outlineOffset="-1px",r.selectorDiv.style.display="block",this.sketchpad.centerViewport?(r.selectorDiv.style.left=this.sketchpad.width/2+e+"px",r.selectorDiv.style.top=this.sketchpad.height/2+i+"px"):(r.selectorDiv.style.left=e+"px",r.selectorDiv.style.top=i+"px"),r.selectorDiv.style.width="1px",r.selectorDiv.style.height="1px",o.containerEl.appendChild(r.selectorDiv),r},moveInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=t.firstX,r=t.firstY;Math.abs(o-e)<this.fieldThreshold||Math.abs(r-i)<this.fieldThreshold?Math.abs(o-e)<Math.abs(r-i)?(t.selectorDiv.style.background="linear-gradient(to right, rgba(0,0,0,.2), transparent)",t.selectorDiv.style.border="1px dashed #888",t.selectorDiv.style.boxSizing="border-box",t.selectorDiv.style.borderRight="",t.selectorDiv.style.outline="",e=o+100):(t.selectorDiv.style.background="linear-gradient(to bottom, rgba(0,0,0,.2), transparent)",t.selectorDiv.style.border="1px dashed #888",t.selectorDiv.style.boxSizing="border-box",t.selectorDiv.style.borderBottom="",t.selectorDiv.style.outline="",i=r+100):(t.selectorDiv.style.outline="1px dashed white",t.selectorDiv.style.border="1px solid black",t.selectorDiv.style.boxSizing="",t.selectorDiv.style.background="",t.selectorDiv.style.filter="");var a=Math.abs(i-r);s.shiftKey&&(e=e<o?o-a:o+a);var n=Math.min(o,e),l=Math.min(r,i),h=Math.max(o,e);a=Math.max(r,i)-l;var c=h-n;this.sketchpad.centerViewport?(t.selectorDiv.style.left=this.sketchpad.width/2+n-1+"px",t.selectorDiv.style.top=this.sketchpad.height/2+l-1+"px"):(t.selectorDiv.style.left=n+"px",t.selectorDiv.style.top=l+"px"),t.selectorDiv.style.width=c+"px",t.selectorDiv.style.height=a+"px"},finishInput:function(t,e,i,s){function o(t){d.onImagehostReady(t.url,a,l,e,i)}s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var r=this.sketchpad,a=t.firstX,l=t.firstY;(Math.abs(a-e)<this.fieldThreshold||Math.abs(l-i)<this.fieldThreshold)&&(Math.abs(a-e)<Math.abs(l-i)?e=a:i=l);var h=Math.abs(i-l);s.shiftKey&&(e=e<a?a-h:a+h);var c=document.createElement("input");c.type="file",c.style.position="fixed",c.style.display="none",c.accept=".jpg,.jpeg,.png,.gif,.svg,image/*;capture=camera",c.click();var d=this;c.addEventListener("change",function(t){var e,i,s=t.target.files;for(e=0;e<s.length;e+=1)i=s[e],window.tmp=new n({progressParentEl:r.progressParentEl||r.containerEl,file:i}).on("success",o).on("error",d.onImagehostError.bind(d))}),r.containerEl.removeChild(t.selectorDiv)},drawFramePath:function(t,e){function i(i){for(s=0;s<r.lay.length;s+=1){switch(r.lay[s]){case a.LAYER_BACK:o=a.contextB2D;break;case a.LAYER_FRONT:o=a.context2D;break;default:o=a.context2D}o.save(),o.beginPath(),o.rotate(a.rotation*Math.PI/180),o.scale(a.scale,a.scale),o.translate(t.vpx,t.vpy),o.translate(-a.viewportX,-a.viewportY),o.scale(1/t.scl,1/t.scl),o.rotate(-t.rot*Math.PI/180),n={x:Math.min(e.x[0],e.x[1]),y:Math.min(e.y[0],e.y[1])},l={x:Math.max(e.x[0],e.x[1]),y:Math.max(e.y[0],e.y[1])},h=l.x-n.x,c=l.y-n.y,h<1&&c<1&&(h=i.width,c=i.height),h<1&&(h=i.width*(c/i.height)),c<1&&(c=i.height*(h/i.width)),r.cen&&(n.x-=i.width/2,n.y-=i.height/2),o.drawImage(i,n.x,n.y,h,c),o.restore()}}var s,o,r=t.cnf,a=this.sketchpad;if(!r||!r.lay||!r.lay.length)return void console.warn("no layers to draw");var n,l,h,c,d=this;r.url?a.resources.getImage(r.url,function(t){t.success&&i(t.img)},function(t){console.warn("error loading image",r.url,t),d.emptyImage.complete&&d.emptyImage.naturalWidth?i(d.emptyImage):d.emptyImage.addEventListener("load",function(){i(d.emptyImage)})}):console.log("error url")}}),X.avaliableTools.push(S),T.prototype=Object.create(w.prototype),Object.assign(T.prototype,{color:{r:0,g:0,b:0,a:1},toolLabel:"Line",toolKey:"l",toolId:"line",lineWidth:1,keyCode:76,startInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=new u({sketchpad:o,id:t,tool:this.toolId,color:this.getColorStr(),size:this.lineWidth,layers:this.layers});r.selectorDiv=document.createElement("div"),r.selectorDiv.style.position="absolute",r.selectorDiv.style.display="block",r.selectorDiv.style.backgroundColor=this.getColorStr(),this.sketchpad.centerViewport?(r.selectorDiv.style.left=this.sketchpad.width/2+e+"px",r.selectorDiv.style.top=this.sketchpad.height/2+i+"px"):(r.selectorDiv.style.left=e+"px",r.selectorDiv.style.top=i+"px"),r.selectorDiv.style.width="1px";var a=this.getSize();return a<1&&(r.selectorDiv.style.borderTop="1px dashed "+this.getColorStr()),r.selectorDiv.style.height=a+"px",r.startX=e,r.startY=i,o.containerEl.appendChild(r.selectorDiv),r.addPoint((new Date).getTime(),e,i),r},connect:function(t,e,i,s,o,r){var a=Math.sqrt((s-e)*(s-e)+(o-i)*(o-i)),n=(e+s)/2-a/2,l=(i+o)/2-r/2,h=Math.atan2(i-o,e-s)*(180/Math.PI);this.sketchpad.centerViewport?(t.style.left=this.sketchpad.width/2+n+"px",t.style.top=this.sketchpad.height/2+l+"px"):(t.style.left=n+"px",t.style.top=l+"px"),t.style.width=a+"px",t.style.transform="rotate("+h+"deg)",t.style.webkitTransform="rotate("+h+"deg)",t.style.MozTransform="rotate("+h+"deg)",t.style.msTransform="rotate("+h+"deg)",t.style.OTransform="rotate("+h+"deg)"},moveInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=t.startX,r=t.startY;if(s.shiftKey){var a=e-o,n=i-r,l=this.distance(o,r,e,i),h=Math.round(Math.atan2(a,n)/(Math.PI/4))*(Math.PI/4);e=o+l*Math.sin(h),i=r+l*Math.cos(h)}var c=o,d=r,p=e,u=i;this.connect(t.selectorDiv,c,d,p,u,this.getSize())},finishInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=t.startX,a=t.startY;if(s.shiftKey){var n=e-r,l=i-a,h=this.distance(r,a,e,i),c=Math.round(Math.atan2(n,l)/(Math.PI/4))*(Math.PI/4);e=r+h*Math.sin(c),i=a+h*Math.cos(c)}t.addPoint((new Date).getTime(),e,i),o.containerEl.removeChild(t.selectorDiv)},drawFramePath:function(t,e){var i,s,o=t.cnf,r=this.sketchpad;if(!o.lay||!o.lay.length)return void console.warn("no layers to draw");for(i=0;i<o.lay.length;i+=1){switch(o.lay[i]){case r.LAYER_BACK:s=r.contextB2D;break;case r.LAYER_FRONT:s=r.context2D;break;default:s=r.context2D}s.save(),s.rotate(r.rotation*Math.PI/180),s.scale(r.scale,r.scale),s.translate(t.vpx,t.vpy),s.translate(-r.viewportX,-r.viewportY),s.scale(1/t.scl,1/t.scl),s.rotate(-t.rot*Math.PI/180),s.beginPath(),s.lineCap="butt",s.lineJoin="round",s.strokeStyle=o.col,s.lineWidth=o.siz,s.moveTo(e.x[0],e.y[0]),s.lineTo(e.x[1],e.y[1]),s.stroke(),s.restore()}}}),X.avaliableTools.push(T),P.prototype=Object.create(w.prototype),Object.assign(P.prototype,{layers:["F"],axis:7,color:{r:0,g:0,b:0,a:1},toolId:"mandala",toolLabel:"Mandala",lineWidth:1,keyCode:77,mirrorV:!1,mirrorH:!0,mirrorVH:!1,rainbow:!1,hideByDefault:!1,getToolConfig:function(){var t=w.prototype.getToolConfig.call(this);return Object.assign(t,{axis:this.axis,mirrorV:this.mirrorV,mirrorH:this.mirrorH,mirrorVH:this.mirrorVH,rainbow:this.rainbow})},setToolConfig:function(t){return w.prototype.setToolConfig.call(this,t),parseInt(t.axis,10)&&(this.axis=parseInt(t.axis,10)),this.mirrorV=t.mirrorV,this.mirrorH=t.mirrorH,this.mirrorVH=t.mirrorVH,this.rainbow=t.rainbow,this.dispatch("changeParams"),this},startInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=w.prototype.startInput.call(this,t,e,i);return o.mirrorV=this.mirrorV,o.mirrorH=this.mirrorH,o.mirrorVH=this.mirrorVH,o.rainbow=this.rainbow,o.axis=this.axis,o},getRbwColorStr:function(t,e){var i={r:0,g:0,b:0,a:1};return i.r=Math.abs(Math.floor(255*Math.sin(t/50)))%255,i.g=Math.abs(Math.floor(255*Math.cos(e/50)))%255,i.b=Math.abs(Math.floor(255*Math.cos(t/50)))%255,"rgba("+i.r+","+i.g+","+i.b+","+i.a+")"},drawFramePath:function(t,e){function i(t,e,i,s){return s%2==1&&(s=1),{x:Math.cos(i)*t-Math.sin(i)*e,y:Math.sin(i)*t+Math.cos(i)*e}}function s(e,i,s){e.save(),e.beginPath(),e.rotate(c.rotation*Math.PI/180),e.scale(c.scale,c.scale),e.translate(t.vpx,t.vpy),e.translate(-c.viewportX,-c.viewportY),e.scale(1/t.scl,1/t.scl),e.rotate(-t.rot*Math.PI/180),e.lineWidth=h.siz,h.rbw?e.strokeStyle=g.getRbwColorStr(i.x,i.y):e.strokeStyle=h.col,e.moveTo(i.x,i.y),e.lineTo(s.x,s.y),e.stroke(),e.restore()}var o,r,a,n,l,h=t.cnf,c=this.sketchpad,d=h.axs;if(!h.lay||!h.lay.length)return void console.warn("no layers to draw");var p,u,g=this;for(a=0;a<h.lay.length;a+=1){switch(h.lay[a]){case c.LAYER_BACK:o=c.contextB2D;break;case c.LAYER_FRONT:o=c.context2D;break;default:o=c.context2D}if(e&&e.x&&e.x.length>1)for(r=1;r<e.x.length;r+=1)for(n=0;n<d;n+=1)l=2*n*Math.PI/d,p=i(e.x[r-1],e.y[r-1],l,n),u=i(e.x[r],e.y[r],l,n),s(o,p,u),h.mrh&&(p=i(e.x[r-1],-e.y[r-1],l,n),u=i(e.x[r],-e.y[r],l,n),s(o,p,u)),h.mrv&&(p=i(-e.x[r-1],e.y[r-1],l,n),u=i(-e.x[r],e.y[r],l,n),s(o,p,u)),h.mrvh&&(p=i(-e.x[r-1],-e.y[r-1],l,n),u=i(-e.x[r],-e.y[r],l,n),s(o,p,u))}}}),X.avaliableTools.push(P),M.prototype=Object.create(w.prototype),Object.assign(M.prototype,{maxLayers:0,keyCode:32,toolLabel:"Move",toolId:"move-viewport",getCursor:function(){return{pointer:"move",border:"none",borderRadius:0,backgroundColor:"rgba(0,0,0,0)"}},startInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=new u({sketchpad:o,id:t,tool:this.toolId});return r.tmpCursor=this.sketchpad.containerEl.style.cursor,r.startX=e,r.startY=i,r.viewportX=this.sketchpad.viewportX,r.viewportY=this.sketchpad.viewportY,o.containerEl.style.cursor="move",o.hudsEl.style.opacity=0,r},moveInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o={x:(e-t.startX)*(1/this.sketchpad.scale),y:(i-t.startY)*(1/this.sketchpad.scale)},r=this.sketchpad;o=this.rotate(-r.rotation,o);var a=t.viewportX-o.x,n=t.viewportY-o.y;s&&s.shiftKey&&(a=10*Math.round(a/10),n=10*Math.round(n/10)),this.sketchpad.setViewportPosition(a,n)},finishInput:function(t,e,i,s){s&&s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10)),this.moveInput(t,e,i,s),this.sketchpad.containerEl.style.cursor=t.tmpCursor,this.sketchpad.hudsEl.style.opacity=1},drawFramePath:function(){}}),X.avaliableTools.push(M),D.prototype=Object.create(w.prototype),Object.assign(D.prototype,{maxLayers:0,keyCode:27,toolLabel:"Null",toolId:"null",startInput:function(t){var e=this.sketchpad,i=new u({sketchpad:e,id:t,tool:this.toolId});return i.tmpCursor=this.sketchpad.containerEl.style.cursor,e.containerEl.style.cursor="none",i},moveInput:function(){},finishInput:function(t){this.sketchpad.containerEl.style.cursor=t.tmpCursor},drawFramePath:function(){}}),X.avaliableTools.push(D),O.prototype=Object.create(w.prototype),Object.assign(O.prototype,{color:{r:0,g:0,b:0,a:1},lineWidth:1,layers:["F"],keyCode:80,toolId:"pen",toolLabel:"Pen"}),X.avaliableTools.push(O),z.prototype=Object.create(w.prototype),Object.assign(z.prototype,{toolId:"rainbow",lineWidth:1,keyCode:66,toolLabel:"Rainbow",hideByDefault:!1,getCursor:function(){var t=parseInt(this.getSize()+1,10);return t+=10,{pointer:"crosshair",marginLeft:-t/2+"px",marginTop:-t/2+"px",width:t+"px",height:t+"px",border:"1px solid black",boxSizing:"border-box",borderRadius:"50%",backgroundColor:"rgba(0,0,0,0)"}},getColorStr:function(t,e){return this.color.r=Math.floor(256*Math.sin(t/50)),this.color.g=Math.floor(256*Math.cos(e/50)),this.color.b=Math.floor(256*Math.cos(t/50)),this.color.a=1,"rgba("+this.color.r+","+this.color.g+","+this.color.b+","+this.color.a+")"},drawFramePath:function(t,e){var i,s,o,r=t.cnf,a=this.sketchpad;if(o=null,!r.lay||!r.lay.length)return void console.warn("no layers to draw");var n,l;for(s=0;s<r.lay.length;s+=1){switch(r.lay[s]){case a.LAYER_BACK:o=a.contextB2D;break;case a.LAYER_FRONT:o=a.context2D;break;default:o=a.context2D}if(o.save(),o.rotate(a.rotation*Math.PI/180),o.scale(a.scale,a.scale),o.translate(t.vpx,t.vpy),o.translate(-a.viewportX,-a.viewportY),o.scale(1/t.scl,1/t.scl),o.rotate(-t.rot*Math.PI/180),e&&e.x&&e.y&&e.x.length>1)for(i=1;i<e.x.length;i+=1)n={x:e.x[i-1],y:e.y[i-1]},l={x:e.x[i],y:e.y[i]},o.beginPath(),o.strokeStyle=this.getColorStr(n.x,n.y),o.lineCap="miter",o.lineJoin="miter",o.lineWidth=r.siz+100/(10+this.distance(n.x,n.y,l.x,l.y)),o.moveTo(n.x,n.y),o.lineTo(l.x,l.y),o.stroke();o.restore()}}}),X.avaliableTools.push(z),F.prototype=Object.create(k.prototype),Object.assign(F.prototype,{layers:["F"],toolLabel:"Rectangle",toolId:"rectangle",keyCode:82,lineWidth:1,color:{r:0,g:0,b:0,a:1},fillColor:{r:255,g:80,b:0,a:0},startInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=new u({sketchpad:o,id:t,tool:this.toolId,color:this.getColorStr(),fillColor:this.getFillColorStr(),size:this.lineWidth,layers:this.layers});return r.firstX=e,r.firstY=i,r.selectorDiv=document.createElement("div"),r.selectorDiv.style.position="absolute",r.selectorDiv.style.border="1px solid black",r.selectorDiv.style.outline="1px dashed white",r.selectorDiv.style.outlineOffset="-1px",r.selectorDiv.style.display="block",this.sketchpad.centerViewport?(r.selectorDiv.style.left=this.sketchpad.width/2+e+"px",r.selectorDiv.style.top=this.sketchpad.height/2+i+"px"):(r.selectorDiv.style.left=e+"px",r.selectorDiv.style.top=i+"px"),r.selectorDiv.style.width="1px",r.selectorDiv.style.height="1px",o.containerEl.appendChild(r.selectorDiv),r.addPoint((new Date).getTime(),e,i),r},moveInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=t.firstX,r=t.firstY,a=Math.abs(i-r);s.shiftKey&&(e=e<o?o-a:o+a);var n=Math.min(o,e),l=Math.min(r,i),h=Math.max(o,e);a=Math.max(r,i)-l;var c=h-n;this.sketchpad.centerViewport?(t.selectorDiv.style.left=this.sketchpad.width/2+n-1+"px",t.selectorDiv.style.top=this.sketchpad.height/2+l-1+"px"):(t.selectorDiv.style.left=n+"px",t.selectorDiv.style.top=l+"px"),t.selectorDiv.style.width=c+"px",t.selectorDiv.style.height=a+"px"},finishInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var o=this.sketchpad,r=t.firstX,a=t.firstY,n=Math.abs(i-a);s.shiftKey&&(e=e<r?r-n:r+n),t.addPoint((new Date).getTime(),e,i),o.containerEl.removeChild(t.selectorDiv)},drawFramePath:function(t,e){var i,s,o=t.cnf,r=this.sketchpad;if(!o.lay||!o.lay.length)return void console.warn("no layers to draw");var a,n;for(i=0;i<o.lay.length;i+=1){switch(o.lay[i]){case r.LAYER_BACK:s=r.contextB2D;break;case r.LAYER_FRONT:s=r.context2D;break;default:s=r.context2D}s.save(),s.beginPath(),s.strokeStyle=o.col,s.fillStyle=o.fcl,s.lineWidth=o.siz,s.rotate(r.rotation*Math.PI/180),s.scale(r.scale,r.scale),s.translate(t.vpx,t.vpy),s.translate(-r.viewportX,-r.viewportY),s.scale(1/t.scl,1/t.scl),s.rotate(-t.rot*Math.PI/180),a={x:e.x[0],y:e.y[0]},n={x:e.x[1],y:e.y[1]},s.rect(a.x,a.y,n.x-a.x,n.y-a.y),s.fill(),s.stroke(),s.restore()}}}),X.avaliableTools.push(F),L.prototype=Object.create(w.prototype),Object.assign(L.prototype,{maxLayers:0,keyCode:32,toolLabel:"Rotate",toolId:"rotate-viewport",getCursor:function(){return{pointer:"default",border:"none",borderRadius:"50%",backgroundColor:"rgba(0,0,0,0)"}},startInput:function(t,e,i){var s=this.sketchpad,o=new u({sketchpad:s,id:t,tool:this.toolId});return o.startRotation=s.rotation,o.startX=e,o.startY=i,o.viewportX=this.sketchpad.viewportX,o.viewportY=this.sketchpad.viewportY,s.hudsEl.style.opacity=0,o},moveInput:function(t,e,i,s){var o=180*Math.atan2(e,i)/Math.PI-180*Math.atan2(t.startX,t.startY)/Math.PI;s.shiftKey&&(o=15*Math.round(o/15)),this.sketchpad.setRotation((-o+t.startRotation)%360)},finishInput:function(t){this.sketchpad.hudsEl.style.opacity=1},drawFramePath:function(){}}),X.avaliableTools.push(L),B.prototype=Object.create(w.prototype),Object.assign(B.prototype,{toolLabel:"Text",toolId:"type",font:"Arial",keyCode:84,color:{r:0,g:0,b:0,a:1},size:14,getToolConfig:function(){var t=w.prototype.getToolConfig.call(this);return Object.assign(t,{font:this.getFont(),size:this.getSize()})},setToolConfig:function(t){return w.prototype.setToolConfig.call(this,t),parseFloat(t.size)&&this.setSize(parseFloat(t.size)),t.font&&this.setFont(t.font),this.dispatch("changeParams"),this},setSize:function(t){return this.size=parseFloat(t),this.dispatch("changeParams"),this},getSize:function(){return this.size},setFont:function(t){return this.font=t,this.dispatch("changeParams"),this},getFont:function(){return this.font},startInput:function(t,e,i,s){function o(){if(a.typeInput.written)return!1;a.typeInput.written=!0,a.addPoint((new Date).getTime(),a.x-1,a.y),a.addPoint((new Date).getTime(),a.x,a.y),a.textContent=a.typeInput.value,r.inputs[667]=a,r.sendInputs(),r.drawInputs(),delete r.inputs[667],r.containerEl.removeChild(a.typeInput)}s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10));var r=this.sketchpad,a=new u({sketchpad:r,id:t,tool:this.toolId,color:this.getColorStr(),font:this.getFont(),size:this.getSize(),layers:this.layers});return a.typeInput=document.createElement("input"),a.typeInput.value="enter text here",a.typeInput.placeholder="enter text here",a.typeInput.style.border=0,a.typeInput.style.boxShadow="none",a.typeInput.style.position="absolute",a.typeInput.style.outline="0",a.typeInput.style.overflow="hidden",a.typeInput.style.padding=0,a.typeInput.style.margin=0,a.typeInput.style.fontFamily=this.getFont(),a.typeInput.style.fontSize=this.getSize()+"px",a.typeInput.style.display="inline-block",a.typeInput.style.color=this.getColorStr(),a.typeInput.style.backgroundColor="rgba(255,255,255,0)",this.sketchpad.centerViewport?(a.typeInput.style.left=this.sketchpad.width/2+e-1+"px",a.typeInput.style.top=this.sketchpad.height/2+i-this.getSize()/2+"px"):(a.typeInput.style.left=e-1+"px",a.typeInput.style.top=i-this.getSize()/2+"px"),a.typeInput.style.width=1e4+"px",a.typeInput.style.height=this.getSize()+"px",a.typeInput.style.lineHeight=this.getSize()+"px",a.typeInput.addEventListener("blur",o),a.typeInput.addEventListener("change",o),a.typeInput.addEventListener("keyup",function(t){13===t.keyCode&&o(),27===t.keyCode&&(a.typeInput.value="",o())}),r.containerEl.appendChild(a.typeInput),a},moveInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10)),
i-=this.getSize()/2,this.sketchpad.centerViewport?(t.typeInput.style.left=this.sketchpad.width/2+e+"px",t.typeInput.style.top=this.sketchpad.height/2+i+"px"):(t.typeInput.style.left=e+"px",t.typeInput.style.top=i+"px")},finishInput:function(t,e,i,s){s.altKey&&(e=10*Math.round(e/10),i=10*Math.round(i/10)),t.x=e,t.y=i,t.typeInput.value="",t.typeInput.focus(),t.typeInput.select()},drawFramePath:function(t,e){var i,s,o=t.cnf,r=this.sketchpad;if(!o.lay||!o.lay.length)return void console.warn("no layers to draw");for(i=0;i<o.lay.length;i+=1){switch(o.lay[i]){case r.LAYER_BACK:s=r.contextB2D;break;case r.LAYER_FRONT:s=r.context2D;break;default:s=r.context2D}s.save(),s.rotate(r.rotation*Math.PI/180),s.scale(r.scale,r.scale),s.translate(t.vpx,t.vpy),s.translate(-r.viewportX,-r.viewportY),s.scale(1/t.scl,1/t.scl),s.rotate(-t.rot*Math.PI/180),s.font=o.siz+"px "+o.fnt,s.fillStyle=o.col,s.textAlign="left",s.textBaseline="middle",s.fillText(o.txt,e.x[0],e.y[0]),s.restore()}}}),X.avaliableTools.push(B),R.prototype=Object.create(e.prototype),Object.assign(R.prototype,{normalize:function(t,e,i){return t<e&&(t=e),t>i&&(t=i),t},triggerUpdate:function(){this.dispatch("change",{size:this.size})},setSize:function(t){this.size=this.normalize(t,this.minValue,this.maxValue),this.sliderEl.style.top=this.height*(this.size-this.minValue)/(this.maxValue-this.minValue)-.015*this.height+"px",this.triggerUpdate()}}),window.Thickness=R,t.fn.sketchpad=function(t){return t||(t={}),this.each(function(e,i){return t.containerEl=i,i.sketchpadModule?i.sketchpadModule:(i.sketchpadModule=new y(t),i.sketchpadModule)})},t.fn.pixelpicker=function(t){return t||(t={}),this.each(function(e,i){return t.containerEl=i,i.pixelpickerModule?i.pixelpickerModule:(i.pixelpickerModule=new c(t),i.pixelpickerModule)})},t.fn.colorpalette=function(t){return t||(t={}),this.each(function(e,s){return t.containerEl=s,s.colorpaletteModule?s.colorpaletteModule:(s.colorpaletteModule=new i(t),s.colorpaletteModule)})}}(jQuery);